(this["webpackJsonpcraftybits-ide"]=this["webpackJsonpcraftybits-ide"]||[]).push([[0],{22:function(e,t,n){},25:function(e,t,n){},30:function(e,t,n){},31:function(e,t,n){},32:function(e,t,n){},33:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){},36:function(e,t,n){},37:function(e,t,n){},38:function(e,t,n){"use strict";n.r(t);var r=n(2),a=n.n(r),c=n(12),s=n.n(c),i=(n(22),n(4)),o=n(5),u=n(10),l={settings:!1};function f(e,t){switch(t.type){case"SET_VISIBLE":return Object(u.a)({},t.modal,!0);case"SET_HIDDEN":return Object(u.a)({},t.modal,!1);default:return e}}var h=n(1),p=Object(r.createContext)();function d(e){var t=Object(r.useReducer)(f,l),n=Object(o.a)(t,2),a=n[0],c=n[1],s={setVisible:function(e){c({type:"SET_VISIBLE",modal:e})},setHidden:function(e){c({type:"SET_HIDDEN",modal:e})}};return Object(h.jsx)(p.Provider,{value:{modalState:a,modalActions:s},children:e.children})}function v(e){localStorage.setItem("craftybits.config",JSON.stringify(e))}function b(e,t){var n;switch(t.type){case"SET_AUTOCONNECT":return v(n=Object(i.a)(Object(i.a)({},e),{},{auto:t.auto})),n;case"SET_DEVICETYPE":return v(n=Object(i.a)(Object(i.a)({},e),{},{deviceType:t.deviceType})),n;case"SET_CONNECTED":case"SET_DISCONNECTED":return Object(i.a)(Object(i.a)({},e),{},{connected:!0});case"SET_DEVICE_INFO":return Object(i.a)(Object(i.a)({},e),{},{info:t.info});case"CLEAR_DEVICE_INFO":return Object(i.a)(Object(i.a)({},e),{},{info:{}});default:return e}}var g=Object(r.createContext)(),m={deviceType:"gio",auto:!1,info:{}};function w(e){m.auto=e.value.auto,m.deviceType=e.value.deviceType;var t=Object(r.useReducer)(b,m),n=Object(o.a)(t,2),a=n[0],c=n[1],s={setAutoconnect:function(e){c({type:"SET_AUTOCONNECT",auto:e})},setDeviceType:function(e){c({type:"SET_DEVICETYPE",deviceType:e})},setConnected:function(){c({type:"SET_CONNECTED"})},setDisconnected:function(){c({type:"SET_DISCONNECTED"})},setDeviceInfo:function(e){c({type:"SET_DEVICE_INFO",info:e})},clearDeviceInfo:function(e){c({type:"CLEAR_DEVICE_INFO"})}};return Object(h.jsx)(g.Provider,{value:{settingsState:a,settingsActions:s},children:e.children})}var y=n(6),k=n(7),j=n(8),x=n(0),O=n.n(x),C=n(3),D=new(function(){function e(){Object(y.a)(this,e),this.port=null,this.reader=null,this.writer=null,this.isConnected=!1,this.onDisconnected=this.onDisconnected.bind(this),this.waitCallback=null,this.waitBuffer=[],this.waitFlag=null,this.waitLength=0,this.callbackListeners={connect:{},disconnect:{},receive:{}}}return Object(k.a)(e,[{key:"registerListener",value:function(e,t){this.callbackListeners[e]?this.callbackListeners[e][t]=t:console.log("Error: Invalid listener type: ".concat(e))}},{key:"removeListener",value:function(e,t){this.callbackListeners[e]?delete this.callbackListeners[e][t]:console.log("Error: Invalid listener type: ".concat(e))}},{key:"scan",value:function(){var e=Object(C.a)(O.a.mark((function e(){var t,n,r,a=this;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.serial.requestPort({filters:[{usbVendorId:3368,usbProductId:516}]});case 3:this.port=e.sent,e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return");case 9:return e.next=11,this.port.open({baudRate:115200});case 11:this.writer=this.port.writable.getWriter(),this.reader=this.port.readable.getReader(),this.port&&this.setConnected(),e.prev=14;case 15:return e.next=18,this.reader.read();case 18:if(t=e.sent,n=t.value,r=t.done,n&&n.forEach((function(e){return a.processInput(e)})),!r){e.next=25;break}return this.reader.releaseLock(),e.abrupt("break",27);case 25:e.next=15;break;case 27:e.next=32;break;case 29:e.prev=29,e.t1=e.catch(14),this.onDisconnected();case 32:case"end":return e.stop()}}),e,this,[[0,6],[14,29]])})));return function(){return e.apply(this,arguments)}}()},{key:"processInput",value:function(e){var t=this;this.waitFlag===e?(this.waitCallback(),this.waitFlag=null,this.waitCallback=null):this.waitLength>0?(this.waitBuffer.push(e),--this.waitLength||(this.waitCallback(Object(j.a)(this.waitBuffer)),this.waitCallback=null,this.waitBuffer=[])):Object.keys(this.callbackListeners.receive).forEach((function(n){t.callbackListeners.receive[n](e)}))}},{key:"setConnected",value:function(){var e=this;this.isConnected=!0,Object.keys(this.callbackListeners.connect).forEach((function(t){e.callbackListeners.connect[t]()}))}},{key:"onDisconnected",value:function(){var e=this;this.isConnected=!1,Object.keys(this.callbackListeners.disconnect).forEach((function(t){e.callbackListeners.disconnect[t]()}))}},{key:"sendAndWait",value:function(){var e=Object(C.a)(O.a.mark((function e(t,n){var r=this;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.waitFlag=n,e.abrupt("return",new Promise((function(e){r.waitCallback=e,r.sendData(t)})));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sendAndWaitLen",value:function(){var e=Object(C.a)(O.a.mark((function e(t,n){var r=this;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.waitLength=n,e.abrupt("return",new Promise((function(e){r.waitCallback=e,r.sendData(t)})));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sendData",value:function(){var e=Object(C.a)(O.a.mark((function e(t){var n,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.writer){e.next=2;break}return e.abrupt("return");case 2:for(n=0;n<t.length;n+=60)r=t.slice(n,n+60),this.writer.write(new Uint8Array(r));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}());var L=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e.charCodeAt(n));return t},E=new(function(){function e(){var t=this;Object(y.a)(this,e),this.usbDevice=null,this.VENDOR_ID=4292,this.PRODUCT_ID=60032,this.waitCallback=null,this.waitBuffer=[],this.waitFlag=null,this.waitLength=0,this.callbackListeners={connect:{},disconnect:{},receive:{}},navigator.hid.addEventListener("disconnect",(function(e){t.isUSBDevice(e.device)&&t.usbDevice&&(t.usbDevice.close(),t.usbDevice=null,Object.keys(t.callbackListeners.disconnect).forEach((function(e){t.callbackListeners.disconnect[e]()})))})),this.handleInputReport=this.handleInputReport.bind(this)}return Object(k.a)(e,[{key:"registerListener",value:function(e,t){this.callbackListeners[e]?this.callbackListeners[e][t]=t:console.log("Error: Invalid listener type: ".concat(e))}},{key:"removeListener",value:function(e,t){this.callbackListeners[e]?delete this.callbackListeners[e][t]:console.log("Error: Invalid listener type: ".concat(e))}},{key:"isUSBDevice",value:function(e){return e.vendorId===this.VENDOR_ID&&e.productId===this.PRODUCT_ID}},{key:"searchForUSB",value:function(){var e=Object(C.a)(O.a.mark((function e(){var t,n,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.hid.requestDevice({filters:[{vendorId:4292,productId:60032}]});case 2:t=e.sent,n=Object(o.a)(t,1),(r=n[0])&&this.startUSB(r);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startUSB",value:function(){var e=Object(C.a)(O.a.mark((function e(t){var n=this;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.open();case 2:if(t.opened){e.next=4;break}return e.abrupt("return");case 4:return this.usbDevice=t,this.usbDevice.oninputreport=this.handleInputReport,e.next=8,this.enableUSBUART();case 8:return e.next=10,this.setBaudrate(115200);case 10:Object.keys(this.callbackListeners.connect).forEach((function(e){n.callbackListeners.connect[e]()}));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleInputReport",value:function(){var e=Object(C.a)(O.a.mark((function e(t){var n,r,a=this;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(console.log(t.data),n=function(){var e=t.data.getUint8(r);a.waitFlag===e?(a.waitCallback(),a.waitFlag=null,a.waitCallback=null):a.waitLength>0?(a.waitBuffer.push(e),--a.waitLength||(a.waitCallback(Object(j.a)(a.waitBuffer)),a.waitCallback=null,a.waitBuffer=[])):Object.keys(a.callbackListeners.receive).forEach((function(t){a.callbackListeners.receive[t](e)}))},r=0;r<t.data.byteLength;r++)n();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getReport",value:function(){var e=Object(C.a)(O.a.mark((function e(t){var n,r,a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.usbDevice.receiveFeatureReport(t);case 2:for(n=e.sent,r=[],a=0;a<n.byteLength;a++)r.push(n.getUint8(a));return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"delay",value:function(){var e=Object(C.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout(e,t)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendReport",value:function(){var e=Object(C.a)(O.a.mark((function e(t,n){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.usbDevice.sendFeatureReport(t,new Uint8Array(n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"run",value:function(){var e=Object(C.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendData([251]);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"writeProgram",value:function(){var e=Object(C.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(n=[253,192,63,t.length]).concat(t),e.next=4,this.sendAndWait(n,75);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"eraseProgram",value:function(){var e=Object(C.a)(O.a.mark((function e(){var t,n,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=[253,0,140,64],n=0;n<64;n++)t.push(255);return e.next=4,this.sendAndWait(t,75);case 4:return e.next=6,this.sendAndWaitLen([252,3],1);case 6:r=e.sent,console.log(r),console.log("memory erased");case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendAndWait",value:function(){var e=Object(C.a)(O.a.mark((function e(t,n){var r=this;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.waitFlag=n,e.abrupt("return",new Promise((function(e){r.waitCallback=e,r.sendData(t)})));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sendStr",value:function(){var e=Object(C.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.sendData(new Uint8Array(L(t)));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendAndWaitLen",value:function(){var e=Object(C.a)(O.a.mark((function e(t,n){var r=this;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.waitLength=n,e.abrupt("return",new Promise((function(e){r.waitCallback=e,r.sendData(t)})));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sendData",value:function(){var e=Object(C.a)(O.a.mark((function e(t){var n,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.usbDevice){e.next=2;break}return e.abrupt("return");case 2:n=0;case 3:if(!(n<t.length)){e.next=10;break}return r=t.slice(n,n+60),e.next=7,this.usbDevice.sendReport(r.length,new Uint8Array(r));case 7:n+=60,e.next=3;break;case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readByte",value:function(){var e=Object(C.a)(O.a.mark((function e(t){var n,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[254,255&t,t>>8&255],e.next=3,this.sendAndWaitLen(n,1);case 3:r=e.sent,console.log(r);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"enableUSBUART",value:function(){var e=Object(C.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendReport(65,[1]);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setBaudrate",value:function(){var e=Object(C.a)(O.a.mark((function e(t){var n,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=[],r=0;r<4;r++)n.unshift(255&t),t>>=8;return n=n.concat([0,0,3,0]),e.next=5,this.sendReport(80,n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}());function S(e){return(e+256).toString(16).substring(1)}function A(e){return("00000000"+(e+4294967296).toString(16)).slice(-8)}function R(e){for(var t=[],n=0;n<e.length;n++)t.push(e.charCodeAt(n));return t}var I="6e400001-b5a3-f393-e0a9-e50e24dcca9e",T=new(function(){function e(){Object(y.a)(this,e),this.device=null,this.readChar=null,this.writeChar=null,this.isConnected=!1,this.waitCallback=null,this.waitBuffer=[],this.waitFlag=null,this.waitLength=0,this.callbackListeners={connect:{},disconnect:{},receive:{}},this.onDisconnected=this.onDisconnected.bind(this)}return Object(k.a)(e,[{key:"scan",value:function(){var e=this;navigator.bluetooth.requestDevice({filters:[{services:[I]}]}).then((function(t){return e.device=t,e.device.addEventListener("gattserverdisconnected",e.onDisconnected),e.device.gatt.connect()})).then((function(e){return e.getPrimaryService(I)})).then((function(t){t.getCharacteristic("6e400002-b5a3-f393-e0a9-e50e24dcca9e").then((function(t){e.writeChar=t})),t.getCharacteristic("6e400003-b5a3-f393-e0a9-e50e24dcca9e").then((function(e){return e.startNotifications()})).then((function(t){t.addEventListener("characteristicvaluechanged",e.handleReadChar.bind(e)),e.readChar=t,e.setConnected()}))})).catch((function(e){return console.log(e)}))}},{key:"disconnect",value:function(){this.device.gatt.disconnect(),this.device=null}},{key:"setConnected",value:function(){var e=this;this.isConnected=!0,Object.keys(this.callbackListeners.connect).forEach((function(t){e.callbackListeners.connect[t]()}))}},{key:"registerListener",value:function(e,t){this.callbackListeners[e]?this.callbackListeners[e][t]=t:console.log("Error: Invalid listener type: ".concat(e))}},{key:"removeListener",value:function(e,t){this.callbackListeners[e]?delete this.callbackListeners[e][t]:console.log("Error: Invalid listener type: ".concat(e))}},{key:"onDisconnected",value:function(){var e=this;this.isConnected=!1,Object.keys(this.callbackListeners.disconnect).forEach((function(t){e.callbackListeners.disconnect[t]()}))}},{key:"handleReadChar",value:function(e){var t=new Uint8Array(e.target.value.buffer);this.processInput(t)}},{key:"processInput",value:function(e){for(var t=this,n=function(){var n=e[r];t.waitFlag===n?(t.waitCallback(),t.waitFlag=null,t.waitCallback=null):t.waitLength>0?(t.waitBuffer.push(n),--t.waitLength||(t.waitCallback(Object(j.a)(t.waitBuffer)),t.waitCallback=null,t.waitBuffer=[])):Object.keys(t.callbackListeners.receive).forEach((function(e){t.callbackListeners.receive[e](n)}))},r=0;r<e.byteLength;r++)n()}},{key:"sendAndWait",value:function(){var e=Object(C.a)(O.a.mark((function e(t,n){var r=this;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.waitFlag=n,e.abrupt("return",new Promise((function(e){r.waitCallback=e,r.sendData(t)})));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sendStr",value:function(){var e=Object(C.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.sendData(new Uint8Array(R(t)));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendAndWaitLen",value:function(){var e=Object(C.a)(O.a.mark((function e(t,n){var r=this;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.waitLength=n,e.abrupt("return",new Promise((function(e){r.waitCallback=e,r.sendData(t)})));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sendData",value:function(){var e=Object(C.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<t.length)){e.next=7;break}return e.next=4,this.send(t.slice(n,n+20));case 4:n+=20,e.next=1;break;case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"send",value:function(e){var t=this;if(this.isConnected)return new Promise((function(n){var r=new Uint8Array(e);t.writeChar.writeValue(r).then((function(){n()}))}))}}]),e}()),N={gio:{type:"hid",RAM_ADDR:536887296,FLASH_ADDR:172032,PROC_ADDR:176128,SRC_ADDR:180224},move:{type:"ble",RAM_ADDR:536887296,FLASH_ADDR:172032,PROC_ADDR:176128,SRC_ADDR:180224},microbit:{type:"serial",RAM_ADDR:536997888,FLASH_ADDR:262144,PROC_ADDR:266240,SRC_ADDR:270336}};var F=function(e){return N[e]},_=new(function(){function e(){Object(y.a)(this,e),this.device="gio",this.type="hid",this.commClass=E,this.callbackListeners={connect:{},disconnect:{},receive:{}},this.commClasses={hid:E,serial:D,ble:T},this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.onReceive=this.onReceive.bind(this)}return Object(k.a)(e,[{key:"setType",value:function(e){var t=F(e);this.device=e,this.type=t.type,this.commClass.removeListener("connect",this.onConnect),this.commClass.removeListener("disconnect",this.onDisconnect),this.commClass.removeListener("receive",this.onReceive),this.commClass=this.commClasses[t.type],this.commClass.registerListener("connect",this.onConnect),this.commClass.registerListener("disconnect",this.onDisconnect),this.commClass.registerListener("receive",this.onReceive)}},{key:"onConnect",value:function(){var e=this;Object.keys(this.callbackListeners.connect).forEach((function(t){e.callbackListeners.connect[t]()}))}},{key:"onDisconnect",value:function(){var e=this;Object.keys(this.callbackListeners.disconnect).forEach((function(t){e.callbackListeners.disconnect[t]()}))}},{key:"onReceive",value:function(e){var t=this;Object.keys(this.callbackListeners.receive).forEach((function(n){t.callbackListeners.receive[n](e)}))}},{key:"registerListener",value:function(e,t){this.callbackListeners[e]?this.callbackListeners[e][t]=t:console.log("Error: Invalid listener type: ".concat(e))}},{key:"removeListener",value:function(e,t){this.callbackListeners[e]?delete this.callbackListeners[e][t]:console.log("Error: Invalid listener type: ".concat(e))}},{key:"search",value:function(){"hid"===this.type?this.commClass.searchForUSB():this.commClass.scan()}},{key:"sendAndWait",value:function(e,t){return this.commClass.sendAndWait(e,t)}},{key:"sendAndWaitLen",value:function(e,t){return this.commClass.sendAndWaitLen(e,t)}}]),e}()),B=(n(25),n(9));n(30);var P=function(e){return Object(h.jsxs)("div",{className:"monitor-frame",children:[Object(h.jsx)("div",{className:"monitor-label",children:e.num}),Object(h.jsx)("div",{className:"monitor-val",children:e.val})]})};var U=Object(B.b)((function(e){return{monitors:e.monitors}}))((function(e){var t=Object(r.useState)(!1),n=Object(o.a)(t,2),a=n[0],c=n[1],s=Object(r.useRef)(null),i=Object(r.useRef)(!0);return Object(r.useEffect)((function(){if(i.current)return i.current=!1,null;c(!0),s.current&&clearTimeout(s.current),s.current=setTimeout((function(){c(!1)}),2e3)}),[e.monitors]),Object(h.jsx)(h.Fragment,{children:a?e.monitors.map((function(e,t){return Date.now()-e.timestamp>3e3?null:Object(h.jsx)(P,{num:t+1,val:e.value},t)})):null})}));n(31);var W=function(e){var t="icon-button ";return t+=e.connected?"connected ":"",t+=e.spinning?"spinning ":"",Object(h.jsx)("div",{title:e.title,className:t,onClick:e.handleClick,children:Object(h.jsx)("img",{className:"icon-button-img ".concat(e.type),src:e.src,alt:e.alt})})},V=n.p+"static/media/settings.f0367329.svg";var M=function(){var e=Object(r.useContext)(p).modalActions;return Object(h.jsx)(W,{title:"Change editor settings",src:V,alt:"Settings Icon",type:"settings",handleClick:function(t){e.setVisible("settings")}})};function H(){return F(_.device).RAM_ADDR}function K(){return F(_.device).FLASH_ADDR}function G(){return F(_.device).PROC_ADDR}function J(){return F(_.device).SRC_ADDR}function q(e){$(e,0)}function Y(e){return z.apply(this,arguments)}function z(){return(z=Object(C.a)(O.a.mark((function e(t){var n,r,a,c,s,i;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[1 of 4] writing ".concat((t.length/1e3).toFixed(1),"KB to memory")),n=Date.now(),r=Date.now(),e.next=5,ie(H(),t);case 5:return a=Date.now()-r,console.log("[2 of 4] copying to flash"),r=Date.now(),e.next=10,_.sendAndWait(R("f1A000,".concat(A(H()),",").concat(A(t.length/4),"#")),85);case 10:return c=Date.now()-r,console.log("[3 of 4] reading data from flash"),r=Date.now(),e.next=15,ce(106496,t.length/4);case 15:s=e.sent,i=Date.now()-r,console.log("[4 of 4] verifying data"),Z(t,s)?(console.log("Success!"),console.log("Flash time: ".concat(((Date.now()-n)/1e3).toFixed(2),"s"),"Mem write: ".concat((t.length/a).toFixed(1),"KBps"),"Flash write: ".concat((t.length/c).toFixed(1),"KBps"),"Flash read: ".concat((t.length/i).toFixed(1),"KBps"))):console.log("Flash failed");case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(){return X.apply(this,arguments)}function X(){return(X=Object(C.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$("v",6);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e,t){if(e.length!==t.length)return!1;var n=!0;return t.forEach((function(t,r){t!==e[r]&&(n=!1,console.log("verify failed: ".concat(A(r)," - should be: ").concat(A(e[r])," actual: ").concat(A(t))))})),n}function $(e,t){return ee.apply(this,arguments)}function ee(){return(ee=Object(C.a)(O.a.mark((function e(t,n){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(C.a)(O.a.mark((function e(r){var a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.sendAndWaitLen(R(t),n);case 2:a=e.sent,r(a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e,t){return ne.apply(this,arguments)}function ne(){return(ne=Object(C.a)(O.a.mark((function e(t,n){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("serial"!==_.type&&"ble"!==_.type){e.next=5;break}return e.next=3,$("W".concat(A(t),",").concat(A(n),"#"),1);case 3:e.next=6;break;case 5:q("W".concat(A(t),",").concat(A(n),"#"));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(e){return ae.apply(this,arguments)}function ae(){return(ae=Object(C.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(C.a)(O.a.mark((function e(n){var r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$("w".concat(A(t),"#"),4);case 2:r=e.sent,n(r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ce(e,t){return se.apply(this,arguments)}function se(){return(se=Object(C.a)(O.a.mark((function e(t,n){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(C.a)(O.a.mark((function e(r){var a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$("R".concat(A(t),",").concat(A(n),"#"),4*n);case 2:a=e.sent,r(a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ie(e,t){return oe.apply(this,arguments)}function oe(){return(oe=Object(C.a)(O.a.mark((function e(t,n){var r,a,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(;n.length%4>0;)n.push(0);r=new Uint8Array(n),a=new DataView(r.buffer),c=0;case 4:if(!(c<r.length)){e.next=10;break}return e.next=7,te(t+c,a.getUint32(c,!0));case 7:c+=4,e.next=4;break;case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ue(e,t){return le.apply(this,arguments)}function le(){return(le=Object(C.a)(O.a.mark((function e(t,n){var r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],0;case 2:if(!(r.length<n)){e.next=12;break}return e.t0=r,e.next=6,re(t);case 6:e.t1=e.sent,r=e.t0.concat.call(e.t0,e.t1),t+=4;case 9:4,e.next=2;break;case 12:return e.abrupt("return",r.slice(0,n));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fe(e,t){return he.apply(this,arguments)}function he(){return(he=Object(C.a)(O.a.mark((function e(t,n){var r,a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],0;case 2:if(!(r.length<n)){e.next=13;break}return a=0,e.next=6,re(t);case 6:e.sent.forEach((function(e,t){a|=e<<8*t})),r=r.concat(a),t+=4;case 10:4,e.next=2;break;case 13:return e.abrupt("return",r);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pe(e,t){return de.apply(this,arguments)}function de(){return(de=Object(C.a)(O.a.mark((function e(t,n){var r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(n),e.next=3,ie(t,n);case 3:return r="f".concat(A(K()),",").concat(A(t),",").concat(Math.ceil(n.length/4),"#"),e.next=6,_.sendAndWait(R(r),85);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ve(e){return be.apply(this,arguments)}function be(){return(be=Object(C.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(H(),G()),e.next=3,ie(H(),t);case 3:return n=A(G()),e.next=6,_.sendAndWait(R("f".concat(n,",").concat(A(H()),",").concat(A(t.length/4),"#")),85);case 6:console.log("procs written");case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ge(e){return me.apply(this,arguments)}function me(){return(me=Object(C.a)(O.a.mark((function e(t){var n,r,a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.length,t.unshift(255&n,n>>8&255,n>>16&255,n>>24&255),e.next=4,ie(H(),t);case 4:return r=A(J()),a="f".concat(r,",").concat(A(H()),",").concat(A((t.length+4)/4),"#"),e.next=8,_.sendAndWait(R(a),85);case 8:console.log("source saved");case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function we(){return(we=Object(C.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("reading source"),t=J(),e.abrupt("return",new Promise(function(){var e=Object(C.a)(O.a.mark((function e(n){var r,a,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe(t,1);case 2:if(!((r=e.sent)>1e3)){e.next=6;break}return n(""),e.abrupt("return");case 6:return e.next=8,ue(t+4,r);case 8:a=e.sent,c="",a.forEach((function(e){255!==e&&0!==e&&(c+=String.fromCharCode(e))})),n(c);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ye(){q("G")}function ke(){return(ke=Object(C.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,je([11]);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function je(e){return xe.apply(this,arguments)}function xe(){return(xe=Object(C.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.push(0),e.next=3,pe(H(),t);case 3:ye();case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Oe=function(e){if(5===e.length){var t={};return t.type="b"===e[4]?"bootloader":"v"===e[4]?"vm":"unknown",t.major=e[1],t.minor=e[2],t.patch=e[3],t}console.log("Error: version string wrong length ".concat(e))},Ce=n.p+"static/media/usb.1d2cfada.svg",De=function(){var e=Object(r.useState)(!1),t=Object(o.a)(e,2),n=t[0],a=t[1],c=Object(r.useContext)(g),s=c.settingsState,i=c.settingsActions;return Object(r.useEffect)((function(){function e(){return t.apply(this,arguments)}function t(){return(t=Object(C.a)(O.a.mark((function e(){var t,n,r,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a(!0),t="",e.next=4,Q();case 4:for(n=e.sent,r=0;r<n.length-1;r++)t+=String.fromCharCode(n[r]);c=Oe(t),i.setDeviceInfo(c),i.setConnected();case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function n(){a(!1),i.clearDeviceInfo(),i.setDisconnected()}return _.setType(s.deviceType),_.registerListener("connect",e),_.registerListener("disconnect",n),function(){_.removeListener("connect",e),_.removeListener("disconnect",n)}}),[s,i]),Object(h.jsx)(W,{title:"Connect to board with USB",src:Ce,alt:"USB Icon",connected:n,handleClick:function(e){_.search()}})},Le=n.p+"static/media/logo.eab4e20f.svg",Ee=n.p+"static/media/download.a641fbae.svg",Se=n.p+"static/media/loading.1d941467.svg",Ae=n.p+"static/media/stop.60e59f26.svg";var Re=function(e){return Object(h.jsxs)("div",{className:"header-frame",children:[Object(h.jsxs)("div",{className:"header-title",children:[Object(h.jsx)("img",{src:Le,alt:"CraftyBits Logo",draggable:"false"}),"CODE"]}),Object(h.jsx)("div",{className:"stretch",children:Object(h.jsx)(U,{})}),Object(h.jsx)(W,{src:Ae,handleClick:e.onStop,title:"Send stop command"}),Object(h.jsx)(M,{}),Object(h.jsx)(W,{src:e.isDownloading?Se:Ee,handleClick:e.onDownload,spinning:e.isDownloading,title:"Download procedures to device"}),Object(h.jsx)(De,{}),e.menuVisible&&Object(h.jsxs)("div",{className:"header-menu",children:["Flash firmware",Object(h.jsx)("br",{}),"Test"]})]})},Ie=function(){function e(t){Object(y.a)(this,e),this.str=t,this.offset=0}return Object(k.a)(e,[{key:"readList",value:function(){for(var e=[];!this.eof();){var t=this.readToken();if(null==t)break;e.push(t)}return e}},{key:"readToken",value:function(){var e=this.next(),t=Number(e);if(!isNaN(t))return t;var n=e.charAt(0);return"]"===n?null:"["===n?this.readList():e}},{key:"next",value:function(){if("'"===this.peekChar())return this.readString();if(";"===this.peekChar())return this.readComment();var e="";if(this.delim())e=this.nextChar();else for(;!this.eof()&&!this.delim();)e+=this.nextChar();return this.skipSpace(),e}},{key:"readString",value:function(){this.nextChar();for(var e="'";;){var t=this.nextChar();if(e+=t,"'"===t)return this.skipSpace(),e;if(this.eof())return e+"'"}}},{key:"readComment",value:function(){this.nextChar()}},{key:"nextLine",value:function(){for(var e="";;){if(this.eof())return e;var t=this.nextChar();if("\n"===t)return e;e+=t}}},{key:"skipSpace",value:function(){for(;;){if(this.eof())return;var e=this.peekChar();if(";"!==e){if(-1===" \t\r\n,".indexOf(e))return;this.nextChar()}else this.skipComment()}}},{key:"skipComment",value:function(){for(;;){var e=this.nextChar();if(this.eof())return;if("\n"===e)return}}},{key:"delim",value:function(){return-1!=="()[] \t\r\n".indexOf(this.peekChar())}},{key:"peekChar",value:function(){return this.str.charAt(this.offset)}},{key:"nextChar",value:function(){return this.str.charAt(this.offset++)}},{key:"eof",value:function(){return this.str.length===this.offset}}]),e}(),Te=["stop","c",0,"output","c",0,"if","c",2,"ifelse","c",3,"repeat","c",2,"loop","c",1,"waituntil","c",1,"+","r",-1,"-","r",-1,"*","r",-1,"/","r",-1,"%","r",-1,"=","r",-1,"!=","r",-1,">","r",-1,"<","r",-1,"and","r",-1,"or","r",-1,"xor","r",-1,"not","r",1,"<<","r",-1,">>","r",-1,"putc","c",1,"prs","c",1,"print","c",1,"prh","c",1,"prhb","c",1,"prf","c",2,"read","r",1,"write","c",2,"readb","r",1,"writeb","c",2,"bset","c",2,"bclr","c",2,"btst","r",2,"ticks","r",0,"resett","c",0,"timer","r",0,"wait","c",1,"random","r",0,"nop","c",0,"ignore","r",1,"readd","r",0,"reada","r",0,"outd","c",1,"outa","c",1,"rsend","c",1,"rrecv","r",0,"rsetbox","c",2,"rgetbox","r",0,"log","c",1,"mon","c",2,"setled","c",2,"setbrightness","c",2,"setservo","c",1,"servo","r",0,"setservoraw","c",1],Ne=["box1","box2","box3","rbox1","rbox2","rbox3"],Fe={all:9999,off:-1};function _e(e){var t=new Ie(e);return t.skipSpace(),t.readList()}var Be=new(function(){function e(){Object(y.a)(this,e)}return Object(k.a)(e,[{key:"lprint",value:function(e){console.log(e)}},{key:"compile",value:function(e){this.pc=0;try{this.thisproc=void 0;var t=this.compileCommands(_e(e));return this.encodeItems(t)}catch(n){console.log(n)}return null}},{key:"downloadProcs",value:function(e){this.pc=this.procaddr;try{this.setup();var t=this.compileProcs(e);return Be.dump(this.procaddr,t),t}catch(n){console.log(n)}}},{key:"vectors",value:function(){for(var e=this,t=[],n=0,r=0;r<e.vectorlen;r++)t.push(0);return function(t,n){a(t,n);for(var r=1;r<e.vectorlen/4;r++)a(t+r,n)}("on-start",0),t;function a(r,a){var c=e.oblist[r];if(void 0!==c){var s=c.addr;t[n++]=a,t[n++]=255&s,t[n++]=s>>8&255,n++}}}},{key:"compileProcs",value:function(e){for(var t=this,n=new Ie(e);!n.eof();)a();for(var r in t.procnames)c(t.procnames[r]);return t.encodeProcs();function a(){var e=n.offset,r=_e(n.nextLine());function a(){n.offset=e,n.readToken()}0!==r.length&&("to"===r[0]?function(){var e=r[1],a={};(function(){if(1===r.length)throw new Error('"to" needs to be followed by a name');if("string"!=typeof r[1])throw new Error(r[1]+" can't be used as a name");a.args=[],a.locals=[];var e=r.slice(2);for(var n in e){var c=e[n];if("string"!=typeof c)throw new Error('"'+c.toString().replace(","," ")+"\" can't be used as an input name");if(":"!==c[0])throw new Error('"'+c+'" needs a ":" to be an input');t.oblist[c]={type:"getlocal",outputs:!0},t.oblist["set"+c]={type:"setlocal",outputs:!1},a.args.push(c)}})(),a.type="ufun",a.len=3,a.nargs=r.length-2,a.body=function(){for(var e="";;){if(n.eof())return e;var t=n.nextLine();if("end"===t)return e;e=e+t+"\n"}}(),a.outputs=null!=a.body.match(/(^|\W)output\W/),t.oblist[e]=a,t.procnames.push(e)}():"constants"===r[0]?function(){a();var e=n.readToken();for(var r in e)t.constants[e[r][0]]=e[r][1]}():"global"===r[0]&&function(){a();var e=n.readToken();for(var r in e)t.setupGlobal(e[r])}())}function c(e){var n=t.oblist[e];t.thisproc=e,n.addr=t.pc,t.pc+=2,n.items=t.compileCommands(_e(n.body+"stop\n"))}}},{key:"compileCommands",value:function(e){for(var t=this,n=[];e.length>0;)r(e.shift());return n;function r(n,i){var f,h=typeof n;"number"===h?a(n):"object"===h?function(t){l(["list",0],3);var n=e;e=t;for(;e.length>0;)r(e.shift());e=n,l(["eol",0],1)}(n):"'"===n.substring(0,1)?(f=(f=(f=(f=n).substring(1)).substring(0,f.length-1)).replaceAll("\\n","\r"),l(["string",f+=String.fromCharCode(0)],f.length+3)):":"===n.substring(0,1)?function(e){var t=o(e);if(void 0===t)throw new Error(e+" has no value"+u());l(["localget",t],2)}(n):"set:"===n.substring(0,4)?c(n):function(n){var r=t.oblist[n];if(void 0!==Fe[n])a(Fe[n]);else{if(void 0===r)throw new Error("I don't know how to '".concat(n+u(),"'"));"global"===r.type?h(r.index):"setglobal"===r.type?f(r.index):"let"===r.type?d():"make"===r.type?v():"opar"===r.type?b():"waituntil"===r.type?p():i()}function i(){s(r.nargs,n),l([r.type,n],r.len)}function f(e){s(1,r);var t=e>2;l(["globalset",t?e-3:e,t?1:0],3)}function h(e){var t=e>2;l(["globalget",t?e-3:e,t?1:0],3)}function p(){l(["list",0],3);var t=e;e=e.shift(),s(1,"waituntil"),e=t,l(["eolr",0],1),l(["prim","waituntil"],1)}function d(){var n=e;for(e=n.shift();e.length>0;){var r=":"+e.shift();t.oblist[r]={type:"getlocal",outputs:!0},t.oblist["set"+r]={type:"setlocal",outputs:!1},t.oblist[t.thisproc].locals.push(r),c("set"+r)}e=n}function v(){var t=e.shift();":"===t.substring(0,1)&&(t=t.substring(1)),'"'===t.substring(0,1)&&(t=t.substring(1));var n=o(t=":"+t);if(void 0===n)throw new Error(t+" has no value"+u());s(1,"make"),l(["localset",n],2)}function b(){if(s(1,"("),")"!==e.shift())throw new Error("() error|")}}(n);var p=t.oblist[n]&&!t.oblist[n].outputs;if(!p&&void 0===i)throw new Error("you don't say what to do with "+n+u());if(i&&p)throw new Error(n+" doesn't output to "+i+u())}function a(e){e<256&&e>=0&&e===Math.round(e)?l(["byte",e],2):l(["number",e],5)}function c(e){var t=e.substring(3),n=o(t);if(void 0===n)throw new Error(t+" has no value"+u());s(1,e),l(["localset",n],2)}function s(t,n){for(var a=0;a<t;a++){if(0===e.length)throw new Error(n+" needs more inputs"+u());r(e.shift(),n),i()}}function i(){if(e.length>0&&t.oblist[e[0]]&&-1===t.oblist[e[0]].nargs){var n=e.shift();if(0===e.length)throw new Error(n+" needs more inputs"+u());r(e.shift(),n),l(["prim",n],1),i()}}function o(e){if(void 0!==t.thisproc){var n=t.oblist[t.thisproc].args,r=n.indexOf(e);if(-1!==r)return n.length-1-r;if(-1!==(r=t.oblist[t.thisproc].locals.indexOf(e)))return 255&-r-1}}function u(){return t.thisproc?" in "+t.thisproc:""}function l(e,r){n.push([t.pc].concat(e)),t.pc+=r}}},{key:"encodeItems",value:function(e){var t=[],n=[];for(var r in e)this.encodeItem(e[r],t,n);return t}},{key:"encodeProcs",value:function(){var e=[],t=[];for(var n in this.procnames){var r=this.oblist[this.procnames[n]],a=r.items;for(var c in e.push(r.args.length),e.push(r.locals.length),a)this.encodeItem(a[c],e,t)}return e}},{key:"encodeItem",value:function(e,t,n){var r=e[2];switch(e[1]){case"byte":t.push(1),t.push(255&r);break;case"number":t.push(2),t.push(255&r),t.push(r>>8&255),t.push(r>>16&255),t.push(r>>24&255);break;case"list":t.push(3),n.push(t.length),t.push(0),t.push(0);break;case"string":t.push(3),t.push(255&r.length),t.push(r.length>>8&255),r.split("").forEach((function(e){t.push(e.charCodeAt(0))}));break;case"eol":a(4);break;case"eolr":a(5);break;case"localget":t.push(6),t.push(r);break;case"localset":t.push(7),t.push(r);break;case"globalget":t.push(8),t.push(r),t.push(e[3]);break;case"globalset":t.push(9),t.push(r),t.push(e[3]);break;case"prim":t.push(this.oblist[r].code);break;case"pseudoprim":case"ufun":t.push(10),t.push(255&this.oblist[r].addr),t.push(this.oblist[r].addr>>8&255);break;default:t.push(e[1])}function a(e){t.push(e);var r=n.pop(),a=t.length-r-2;t[r]=255&a,t[r+1]=a>>8&255}}},{key:"dumpw",value:function(e,t){for(var n=0;n<t.length;n+=4){for(var r=A(e+n)+" - ",a=0;a<4&&!(n+a>=t.length);a++)r+=A(t[a+n]),r+=" ";console.log(r)}}},{key:"dump",value:function(e,t){for(var n=0;n<t.length;n+=8){for(var r=A(e+n)+" - ",a=0;a<8&&!(n+a>=t.length);a++)r+=S(t[a+n]),r+=" ";console.log(r)}}},{key:"setupGlobal",value:function(e){this.oblist[e]={type:"global",index:this.nextglobal,outputs:!0},this.oblist["set"+e]={type:"setglobal",index:this.nextglobal,outputs:!1},this.nextglobal++}},{key:"setup",value:function(){var e=this;for(var t in this.procaddr=0,e.vectorlen=4,e.oblist={},e.constants={},e.nextglobal=0,e.procnames=[],function(){var t=11,n=[].concat(Te);for(;n.length>0;){var r=n.shift(),a="r"===n.shift(),c=n.shift();e.oblist[r]={type:"prim",len:1,code:t++,nargs:c,outputs:a}}}(),e.oblist.let={type:"let",outputs:!1},e.oblist.make={type:"make",outputs:!1},e.oblist["("]={type:"opar",outputs:!0},e.oblist.waituntil.type="waituntil",Ne)e.setupGlobal(Ne[t])}}]),e}());Be.setup();var Pe=Be;for(var Ue=function(e){var t=Object(r.useState)(!1),n=Object(o.a)(t,2),a=n[0],c=n[1],s=Object(r.useState)(!1),i=Object(o.a)(s,2),u=i[0],l=i[1],f=function(){var t=Object(C.a)(O.a.mark((function t(){var n,r,a;return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(l(!0),n=e.procRef.current.value,r=R(n),(a=Pe.downloadProcs(n))&&0!==a.length){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,ve(a);case 8:return t.next=10,ge(r);case 10:l(!1);case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(h.jsx)(Re,{onToggleMenu:function(e){c(!a)},menuVisible:a,onDownload:f,onStop:function(){!function(){ke.apply(this,arguments)}()},isDownloading:u})},We="setMonitor",Ve=[],Me=0;Me<10;Me++)Ve.push({value:0,timestamp:0});var He={monitors:Ve};var Ke=function(e){if(5===e.length){var t={};return t.type="b"===e[4]?"bootloader":"v"===e[4]?"vm":"unknown",t.major=e[1],t.minor=e[2],t.patch=e[3],t}console.log("Error: version string wrong length ".concat(e))};n(32);var Ge=function(e){var t="left"===e.side?"10px 5px 10px 10px":"10px 10px 10px 5px",n={display:"flex",flex:e.flex,padding:t};return Object(h.jsxs)("div",{className:"editor-frame",style:n,children:[Object(h.jsx)("div",{className:"editor-tools",children:e.tools}),Object(h.jsx)("div",{className:"editor-text-frame",children:Object(h.jsx)("textarea",{ref:e.textRef,className:"editor-text",onKeyDown:e.onChange,defaultValue:e.defaultValue,autoCapitalize:"false",autoCorrect:"false",autoComplete:"false",spellCheck:"false"})})]})};var Je=Object(B.b)(null,(function(e){return{updateMonitor:function(t,n){return e(function(e,t){return{type:We,mon:e,val:t}}(t,n))}}}))((function(e){var t=Object(r.useContext)(g).settingsActions,n=Object(r.useRef)(null);return Object(r.useEffect)((function(){var r="";function a(a){var c,s;13===a?("%"===r[0]?console.log(r.substr(1)):"*"===r[0]?function(e){var n=Ke(e);t.setDeviceInfo(n)}(r):"#"===r[0]?(c=r[1],s=r.substr(2),e.updateMonitor(c,s)):function(e){e+="\n";var t=n.current,r=t.selectionStart,a=t.selectionEnd,c=t.value,s=c.substring(0,r),i=c.substring(a),o=t.scrollTop;t.value=s+e;var u=t.scrollHeight-t.scrollTop-t.offsetHeight;t.value=s+e+i,t.selectionStart=r+e.length,t.selectionEnd=r+e.length,u>0?t.scrollTop+=u:t.scrollTop=o}(r),r=""):r+=String.fromCharCode(a)}return _.registerListener("receive",a),function(){_.removeListener("receive",a)}}),[t,e]),Object(h.jsx)(Ge,{textRef:n,flex:e.weight,side:e.side,onChange:function(e){13===e.keyCode&&(e.shiftKey?function(e){e.preventDefault();var t=n.current,r=t.selectionStart,a=t.value,c=a.substring(0,r),s=a.substring(r);t.value=c+"\n"+s,t.selectionStart=r+1,t.selectionEnd=r+1}(e):function(e){var t=n.current,r=t.selectionStart,a=t.value.lastIndexOf("\n",r-1),c=t.value.indexOf("\n",r);c<0&&(c=t.value.length);t.selectionStart=c+1,c!==t.value.length&&e.preventDefault();var s=t.value.substring(a+1,c),i=Pe.compile(s);i&&je(i)}(e))},defaultValue:"Welcome to LOGO!\n"})})),qe=(n(33),function(e){var t=Object(r.useState)(null),n=Object(o.a)(t,2),a=n[0],c=n[1],s=Object(r.useContext)(g).settingsState;return Object(r.useEffect)((function(){Object.keys(s.info).length>0&&"vm"===s.info.type&&function(){return we.apply(this,arguments)}().then((function(e){console.log(e),Pe.downloadProcs(e),c(e)}))}),[s.info]),Object(h.jsxs)("div",{className:"editor-container",children:[Object(h.jsx)(Je,{weight:4,side:"left"}),Object(h.jsx)(Ge,{flex:6,side:"right",textRef:e.procRef,defaultValue:a})]})});n(34);var Ye=function(){return Object(h.jsx)("div",{className:"footer-frame",children:"CraftyBits - Kreg Hanning 2021"})};n(35);var ze=function(e){return Object(h.jsx)("div",{className:"box-frame",onClick:e.onClose,children:Object(h.jsx)("div",{className:"box-content",onClick:function(e){e.stopPropagation()},children:e.children})})};var Qe=function(e){return Object(h.jsx)(ze,Object(i.a)({},e))};n(36);var Xe=function(e){var t=Object.keys(e.devInfo).length>0;return Object(h.jsx)(Qe,{onClose:e.closeSettings,children:Object(h.jsxs)("div",{className:"settings-frame",children:[Object(h.jsx)("div",{className:"settings-header",children:"Settings"}),Object(h.jsxs)("div",{className:"settings-row",children:["Device:",Object(h.jsxs)("select",{name:"device-type",className:"settings-device-type",onChange:e.changeSettings,value:e.deviceType,children:[Object(h.jsx)("option",{value:"gio",children:"CraftyBits Gio"}),Object(h.jsx)("option",{value:"move",children:"CraftyBits Move"}),Object(h.jsx)("option",{value:"microbit",children:"micro:bit"})]})]}),Object(h.jsx)("div",{className:"settings-title",children:"Device Info"}),Object(h.jsxs)("div",{className:"settings-row",children:["Status: ",t?"connected":"Not connected"]}),t&&Object(h.jsxs)("div",{className:"settings-dev-info",children:[Object(h.jsxs)("div",{className:"settings-row",children:["mode: ",e.devInfo.type]}),Object(h.jsxs)("div",{className:"settings-row",children:["version: ",e.devInfo.major,".",e.devInfo.minor,".",e.devInfo.patch]}),Object(h.jsx)("button",{className:"settings-button",disabled:e.isFlashing,children:"Disconnect"}),Object(h.jsx)("br",{}),!e.webserial&&Object(h.jsx)("button",{className:"settings-button",onClick:function(){var t="vm"===e.devInfo.type?"bootloader":"vm";e.onReset(t)},disabled:e.isFlashing,children:"vm"===e.devInfo.type?"Reset to Bootloader":"Launch vm"}),Object(h.jsx)("br",{}),"bootloader"===e.devInfo.type&&Object(h.jsx)("button",{className:"settings-button",onClick:e.onFlashFirmware,disabled:e.isFlashing,children:"Flash Firmware"})]})]})})};var Ze=function(e){var t=Object(r.useContext)(g),n=t.settingsState,a=t.settingsActions,c=Object(r.useState)(!1),s=Object(o.a)(c,2),u=s[0],l=s[1],f=Object(r.useContext)(p).modalActions;function d(e){var t=e.target.files[0],n=new FileReader;n.onload=function(){var e=Object(C.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Uint8Array(t.target.result),e.next=3,Y(n);case 3:l(!1);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.readAsArrayBuffer(t)}return Object(h.jsx)(Xe,Object(i.a)({autoconnect:n.auto,deviceType:n.deviceType,devInfo:n.info,closeSettings:function(){f.setHidden("settings")},changeSettings:function(e){switch(e.target.name){case"autoconnect":a.setAutoconnect(e.target.checked);break;case"device-type":a.setDeviceType(e.target.value)}},onReset:function(e){"bootloader"===e?$("R",0):"vm"===e&&ye()},onFlashFirmware:function(e){if(l(!0),e.shiftKey){var t=document.createElement("input");t.type="file",t.oninput=d,t.click()}else fetch("https://craftybits.net/firmware/gio/latest").then((function(e){return e.arrayBuffer()})).then(function(){var e=Object(C.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Uint8Array(t),e.next=3,Y(n);case 3:l(!1);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},isFlashing:u},e))};n(37);var $e=function(){var e=Object(r.useContext)(p).modalState,t=Object(r.useContext)(g).settingsState,n=Object(r.createRef)();return Object(r.useEffect)((function(){_.setType(t.deviceType)}),[t]),Object(h.jsxs)("div",{className:"gui-frame",children:[t.auto,Object(h.jsx)("div",{className:"gui-header",children:Object(h.jsx)(Ue,{procRef:n})}),Object(h.jsx)("div",{className:"gui-body",children:Object(h.jsx)(qe,{procRef:n})}),Object(h.jsx)("div",{className:"gui-footer",children:Object(h.jsx)(Ye,{})}),e.settings&&Object(h.jsx)(Ze,{})]})};var et=function(){var e=function(){var e=localStorage.getItem("craftybits.config");return e?JSON.parse(e):null}(),t=Object(i.a)({auto:!1,deviceType:"gio"},e);return Object(h.jsx)(w,{value:t,children:Object(h.jsx)(d,{children:Object(h.jsx)($e,{})})})},tt=n(17);var nt={createConnection:function(){new RTCPeerConnection(null).createOffer().then((function(e){console.log(e.sdp),console.log(btoa(unescape(encodeURIComponent(e.sdp))))}))}};window.Compiler=Pe,window.dump=function(e,t){return new Promise((function(n){t<4&&(t=4),ue(e,t).then((function(e){return n(e)}))}))},window.dumpw=function(e,t){return new Promise((function(n){t<1&&(t=1),fe(e,t).then((function(e){return n(e)}))}))},window.writeMemory=ie,window.readMemory=ue,window.WebRTC=nt,window.sendstr=q;var rt=Object(tt.a)((function(e,t){switch("undefined"===typeof e&&(e=He),t.type){case We:var n=Object(j.a)(e.monitors);return n[t.mon-1].value=t.val,n[t.mon-1].timestamp=Date.now(),Object.assign({},e,{monitors:n});default:return e}}));s.a.render(Object(h.jsx)(a.a.StrictMode,{children:Object(h.jsx)(B.a,{store:rt,children:Object(h.jsx)(et,{})})}),document.getElementById("root"))}},[[38,1,2]]]);
//# sourceMappingURL=main.1d2fda96.chunk.js.map
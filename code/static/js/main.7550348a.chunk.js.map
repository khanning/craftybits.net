{"version":3,"sources":["reducers/modals.js","contexts/modals.js","lib/local-settings.js","reducers/settings.js","contexts/settings.js","lib/webserial.js","lib/str-to-bytes.js","lib/webhid.js","lib/formatting.js","lib/webbt.js","lib/device-spec.js","lib/comms.js","components/monitor/monitor.js","components/toolbar-monitors/toolbar-monitors.js","components/icon-button/icon-button.js","icons/settings.svg","containers/settings-button.js","lib/vm-commands.js","lib/version-parser.js","icons/usb.svg","containers/usb-button.js","components/header/logo.svg","icons/download.svg","icons/loading.svg","icons/stop.svg","icons/start.svg","icons/help.svg","components/header/header.js","lib/tokenizer.js","lib/prims.js","lib/parse.js","lib/compiler.js","reducers/monitors.js","containers/header.js","hooks/use-version-parser.js","components/editor/editor.js","containers/command-center.js","components/editor-container/editor-container.js","components/footer/footer.js","components/box/box.js","containers/box.js","components/settings-modal/settings-modal.js","containers/settings-modal.js","components/help-modal/help-outputs.js","components/help-modal/help-modal.js","components/help-modal/help-dictionary.js","containers/help-modal.js","components/gui/gui.js","containers/gui.js","lib/webrtc.js","index.js"],"names":["initialState","settings","help","reducer","state","action","type","modal","ModalContext","createContext","ModalProvider","props","useReducer","modalReducer","dispatch","actions","setVisible","setHidden","Provider","value","modalState","modalActions","children","saveSettings","localStorage","setItem","JSON","stringify","newSettings","auto","deviceType","connected","info","SettingsContext","SettingsProvider","settingsReducer","setAutoconnect","setDeviceType","setConnected","setDisconnected","setDeviceInfo","dev","clearDeviceInfo","settingsState","settingsActions","webserial","this","port","reader","writer","isConnected","onDisconnected","bind","waitCallback","waitBuffer","waitFlag","waitLength","callbackListeners","connect","disconnect","receive","fcn","console","log","a","navigator","serial","requestPort","filters","usbVendorId","usbProductId","open","baudRate","writable","getWriter","readable","getReader","read","done","forEach","b","processInput","releaseLock","c","push","Object","keys","key","data","flag","Promise","res","sendData","len","i","length","out","slice","write","Uint8Array","strToBytes","str","charCodeAt","webhid","usbDevice","VENDOR_ID","PRODUCT_ID","hid","addEventListener","event","isUSBDevice","device","close","handleInputReport","vendorId","productId","requestDevice","startUSB","opened","oninputreport","enableUSBUART","setBaudrate","end","byteLength","reportId","getUint8","r","receiveFeatureReport","report","ms","setTimeout","sendFeatureReport","code","concat","sendAndWait","sendAndWaitLen","sendReport","addr","unshift","hexByte","n","toString","substring","hexWord","MICROVM_UUID","webbt","readChar","writeChar","bluetooth","services","then","d","gatt","server","getPrimaryService","service","getCharacteristic","startNotifications","handleReadChar","catch","error","input","target","buffer","send","resolve","output","writeValue","DEVICE_SPEC","gio","RAM_ADDR","FLASH_ADDR","PROC_ADDR","SRC_ADDR","move","microbit","getDeviceSpec","name","comms","commClass","WebHID","commClasses","WebSerial","ble","WebBluetooth","onConnect","onDisconnect","onReceive","spec","removeListener","registerListener","searchForUSB","scan","MonitorComponent","className","num","val","monitors","useState","isVisible","setIsVisible","visibleTimeout","useRef","firstRun","useEffect","current","clearTimeout","map","mon","Date","now","timestamp","IconButtonComponent","classNames","spinning","title","onClick","handleClick","src","alt","SettingsButton","useContext","settingsIcon","e","Comms","sendstr","sendReceive","writeBin","bin","toFixed","start","time","writeMemory","ramTime","writeTime","readWords","mem","readTime","verifyMemory","getVersion","dst","isValid","resp","writeWord","w","readWord","bytes","DataView","getUint32","readMemory","readMemoryWord","sendCommand","command","Math","ceil","download","procAddr","saveSource","srcAddr","source","String","fromCharCode","vmGo","runCmd","versionParser","verString","version","major","minor","patch","USBButton","setIsConnected","ver","setType","usbIcon","search","HeaderComponent","logo","draggable","helpIcon","onHelp","startIcon","onStart","stopIcon","onStop","isDownloading","loadingIcon","downloadIcon","onDownload","menuVisible","Tokenizer","s","offset","eof","token","readToken","next","Number","isNaN","first","charAt","readList","peekChar","readString","readComment","delim","nextChar","skipSpace","indexOf","skipComment","prims","globals","constants","all","off","parse","t","compiler","pc","thisproc","undefined","compiledtokens","compileCommands","encodeItems","procaddr","setup","compileProcs","dump","nextvector","vectorlen","op","setupVector","setupVectors","proc","oblist","tk","onePass1Command","procnames","compileProcBody","encodeProcs","sol","parsed","nextLine","backup","Error","args","locals","arg","replace","outputs","parseTitleLine","nargs","body","line","gatherBody","match","parseTo","ks","parseConstants","setupGlobal","parseGlobal","items","list","compileItem","shift","item","inputfor","compileNumber","l","addAndCount","oldlist","compileList","replaceAll","index","localIndex","thisProc","compileLocalGet","compileLocalSet","sym","compileGlobalGet","compileGlobalSet","compileLet","compileMake","compileOpar","compileWaituntil","compileCallSym","argloop","rbox","old","local","compileSymbol","round","setname","infixCheck","isym","x","lists","encodeItem","split","addEOL","pop","nextglobal","ops","setupBuiltIns","Header","setMenuVisible","downloading","setDownloading","handleDownload","procRef","strBytes","Compiler","downloadProcs","onToggleMenu","vmStop","SET_MONITOR","defaultMonitors","useVersionParser","EditorComponent","padding","side","flexStyle","display","flex","classes","showDefaultText","style","tools","ref","textRef","onKeyDown","onChange","onDrop","onFocus","onBlur","defaultValue","autoCapitalize","autoCorrect","autoComplete","spellCheck","updateMonitor","setMonitor","setShowDefaultText","defaultText","respStr","handleReceive","substr","ParseVersion","startPos","selectionStart","endPos","selectionEnd","before","after","oldTop","scrollTop","halfScroll","scrollHeight","offsetHeight","insert","weight","keyCode","shiftKey","preventDefault","pos","insertCR","lastIndexOf","compile","runCommand","EditorContainer","sourceCode","setSourceCode","readSource","stopPropagation","file","dataTransfer","files","FileReader","onload","result","readAsText","FooterComponent","BoxComponent","onClose","Box","SettingsModalComponent","devActive","devInfo","closeSettings","changeSettings","disabled","isFlashing","onReset","onFlashFirmware","SettingsModal","setIsFlashing","handleUpload","readAsArrayBuffer","autoconnect","checked","document","createElement","oninput","click","fetch","arrayBuffer","HelpOutputs","cmds","commandList","argDivs","argKeys","tmp","description","example","commands","HelpModalComponent","categories","selected","HelpDictionary","Outputs","STATE","POWER","DEGREES","LED","COLOR","BRIGHTNESS","Inputs","Control","MILLIS","CONDITION","COUNT","SUBROUTINE","SUBROUTINE1","SUBROUTINE2","Utils","NUMBER","STRING","Variables","VALUE","Operators","HelpModal","selectedCategory","setSelectedCategory","categoryDivs","classname","GUIComponent","createRef","handleDrop","GUI","savedSettings","getItem","getSettings","defaultSettings","webrtc","createConnection","RTCPeerConnection","createOffer","desc","sdp","btoa","unescape","encodeURIComponent","window","dumpw","WebRTC","store","createStore","change","assign","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.7550348a.chunk.js","sourcesContent":["const initialState = {\n    settings: false,\n    help: false\n};\n\nfunction reducer(state, action) {\n    switch(action.type) {\n        case 'SET_VISIBLE':\n            return { [action.modal]: true }\n        case 'SET_HIDDEN':\n            return { [action.modal]: false }\n        default: return state;\n    }\n}\n\nexport {\n    reducer as default,\n    initialState\n}\n","import { useReducer, createContext } from 'react';\n\nimport modalReducer, { initialState } from '../reducers/modals.js';\n\nconst ModalContext = createContext();\n\nfunction ModalProvider(props) {\n    const [state, dispatch] = useReducer(modalReducer, initialState);\n\n    const actions = {\n        setVisible: modal => {\n            dispatch({ type: 'SET_VISIBLE', modal: modal });\n        },\n        setHidden: modal => {\n            dispatch({ type: 'SET_HIDDEN', modal: modal });\n        }\n    };\n\n    return (\n        <ModalContext.Provider\n            value={{\n                modalState: state,\n                modalActions: actions\n            }}\n        >\n            {props.children}\n        </ModalContext.Provider>\n    );\n}\n\nexport { ModalProvider, ModalContext };\n","function getSettings() {\n    const settings = localStorage.getItem('craftybits.config');\n    if (!settings) return null;\n    return JSON.parse(settings);\n}\n\nfunction saveSettings(settings) {\n    localStorage.setItem('craftybits.config', JSON.stringify(settings));\n}\n\nexport {\n    getSettings,\n    saveSettings\n}\n","import { saveSettings } from '../lib/local-settings.js';\n\nconst initialState = {\n    auto: false,\n    deviceType: 'gio',\n    connected: false,\n    info: {}\n};\n\nfunction reducer(state, action) {\n    let newSettings;\n    switch(action.type) {\n        case 'SET_AUTOCONNECT':\n            newSettings = {\n                ...state,\n                auto: action.auto\n            }\n            saveSettings(newSettings);\n            return newSettings;\n        case 'SET_DEVICETYPE':\n            newSettings = {\n                ...state,\n                deviceType: action.deviceType\n            }\n            saveSettings(newSettings);\n            return newSettings;\n        case 'SET_CONNECTED':\n            return {\n                ...state,\n                connected: true\n            }\n        case 'SET_DISCONNECTED':\n            return {\n                ...state,\n                connected: true\n            }\n        case 'SET_DEVICE_INFO':\n            return {\n                ...state,\n                info: action.info\n            }\n        case 'CLEAR_DEVICE_INFO':\n            return {\n                ...state,\n                info: {}\n            }\n        default: return state;\n    }\n}\n\nexport {\n    reducer as default,\n    initialState\n}\n","import { useReducer, createContext } from 'react';\n\nimport settingsReducer from '../reducers/settings.js';\n\nconst SettingsContext = createContext();\n\nconst initialState = {\n    deviceType: 'gio',\n    auto: false,\n    info: {}\n};\n\nfunction SettingsProvider(props) {\n    initialState.auto = props.value.auto;\n    initialState.deviceType = props.value.deviceType;\n    const [state, dispatch] = useReducer(settingsReducer, initialState);\n\n    const actions = {\n        setAutoconnect: auto => {\n            dispatch({ type: 'SET_AUTOCONNECT', auto: auto });\n        },\n        setDeviceType: type => {\n            dispatch({ type: 'SET_DEVICETYPE', deviceType: type });\n        },\n        setConnected: () => {\n            dispatch({ type: 'SET_CONNECTED' });\n        },\n        setDisconnected: () => {\n            dispatch({ type: 'SET_DISCONNECTED' });\n        },\n        setDeviceInfo: dev => {\n            dispatch({ type: 'SET_DEVICE_INFO', info: dev });\n        },\n        clearDeviceInfo: dev => {\n            dispatch({ type: 'CLEAR_DEVICE_INFO' });\n        }\n    };\n\n    return (\n        <SettingsContext.Provider\n            value={{\n                settingsState: state,\n                settingsActions: actions\n            }}\n        >\n            {props.children}\n        </SettingsContext.Provider>\n    );\n}\n\nexport { SettingsProvider, SettingsContext };\n","class WebSerial {\n    constructor () {\n        this.port = null;\n        this.reader = null;\n        this.writer = null;\n        this.isConnected = false;\n        this.onDisconnected = this.onDisconnected.bind(this);\n\n        this.waitCallback = null;\n        this.waitBuffer = [];\n        this.waitFlag = null;\n        this.waitLength = 0;\n\n        this.callbackListeners = {\n            connect: {},\n            disconnect: {},\n            receive: {}\n        };\n    }\n\n    registerListener (type, fcn) {\n        if (!this.callbackListeners[type]) {\n            console.log(`Error: Invalid listener type: ${type}`);\n            return;\n        }\n        this.callbackListeners[type][fcn] = fcn;\n    }\n\n    removeListener (type, fcn) {\n        if (!this.callbackListeners[type]) {\n            console.log(`Error: Invalid listener type: ${type}`);\n            return;\n        }\n        delete this.callbackListeners[type][fcn];\n    }\n\n    async scan () {\n        try {\n            this.port = await navigator.serial.requestPort({\n                filters: [{usbVendorId: 0x0d28, usbProductId: 0x0204}]\n            });\n        } catch (e) { return; }\n        await this.port.open({ baudRate: 115200 });\n        this.writer = this.port.writable.getWriter();\n        this.reader = this.port.readable.getReader();\n        if (this.port) {\n            this.setConnected();\n        }\n        try {\n            while (true) {\n                const { value, done } = await this.reader.read();\n                if (value) value.forEach(b => this.processInput(b));\n                if (done) {\n                    this.reader.releaseLock();\n                    break;\n                }\n            }\n        } catch (e) {\n            this.onDisconnected();\n        }\n    }\n\n    processInput (c) {\n        if (this.waitFlag === c) {\n            this.waitCallback();\n            this.waitFlag = null;\n            this.waitCallback = null;\n        } else if (this.waitLength > 0) {\n            this.waitBuffer.push(c);\n            if (!--this.waitLength) {\n                this.waitCallback([...this.waitBuffer]);\n                this.waitCallback = null;\n                this.waitBuffer = [];\n            }\n        } else {\n            Object.keys(this.callbackListeners.receive).forEach(key => {\n                this.callbackListeners.receive[key](c);\n            });\n        }\n    }\n\n    setConnected () {\n        this.isConnected = true;\n        Object.keys(this.callbackListeners.connect).forEach(key => {\n            this.callbackListeners.connect[key]();\n        });\n    }\n\n    onDisconnected () {\n        this.isConnected = false;\n        Object.keys(this.callbackListeners.disconnect).forEach(key => {\n            this.callbackListeners.disconnect[key]();\n        });\n    }\n\n    async sendAndWait (data, flag) {\n        this.waitFlag = flag;\n        return new Promise(res => {\n            this.waitCallback = res;\n            this.sendData(data);\n        });\n    }\n\n    async sendAndWaitLen (data, len) {\n        this.waitLength = len;\n        return new Promise(res => {\n            this.waitCallback = res;\n            this.sendData(data);\n        });\n    }\n\n    async sendData (b) {\n        if (!this.writer) return;\n        for (let i=0; i<b.length; i+=60) {\n            const out = b.slice(i, i+60);\n            // console.log(`sending ${out}`)\n            this.writer.write(new Uint8Array(out));\n        }\n    }\n}\n\nconst webserial = new WebSerial();\nexport default webserial;\n","function strToBytes (str) {\n    let res = [];\n    for (let i=0; i<str.length; i++) res.push(str.charCodeAt(i));\n    return res;\n}\n\nexport default strToBytes;\n","import strToBytes from './str-to-bytes.js';\n\nclass WebHID {\n    constructor() {\n        this.usbDevice = null\n        this.VENDOR_ID = 0x10C4;\n        this.PRODUCT_ID = 0xEA80;\n\n        this.waitCallback = null;\n        this.waitBuffer = [];\n        this.waitFlag = null;\n        this.waitLength = 0;\n\n        this.callbackListeners = {\n            connect: {},\n            disconnect: {},\n            receive: {}\n        };\n\n        // navigator.hid.addEventListener('connect', async event => {\n            // if (!this.isUSBDevice(event.device)) return;\n            // this.startUSB(event.device);\n        // });\n\n        navigator.hid.addEventListener('disconnect', event => {\n            if (!this.isUSBDevice(event.device)) return;\n            if (this.usbDevice) {\n                this.usbDevice.close();\n                this.usbDevice = null;\n                Object.keys(this.callbackListeners.disconnect).forEach(key => {\n                    this.callbackListeners.disconnect[key]();\n                });\n            }\n        });\n\n        // navigator.hid.getDevices()\n        // .then(device => {\n            // if (device[0]) this.startUSB(device[0]);\n        // });\n\n        this.handleInputReport = this.handleInputReport.bind(this);\n    }\n\n    registerListener (type, fcn) {\n        if (!this.callbackListeners[type]) {\n            console.log(`Error: Invalid listener type: ${type}`);\n            return;\n        }\n        this.callbackListeners[type][fcn] = fcn;\n    }\n\n    removeListener (type, fcn) {\n        if (!this.callbackListeners[type]) {\n            console.log(`Error: Invalid listener type: ${type}`);\n            return;\n        }\n        delete this.callbackListeners[type][fcn];\n    }\n\n    isUSBDevice(dev) {\n        return (dev.vendorId === this.VENDOR_ID && dev.productId === this.PRODUCT_ID);\n    }\n\n    async searchForUSB() {\n        const [device] = await navigator.hid.requestDevice({ filters: [{ vendorId: 0x10c4, productId: 0xea80 }] })\n        if (device) this.startUSB(device);\n    }\n\n    async startUSB(device) {\n        await device.open();\n        if (!device.opened) return;\n        this.usbDevice = device;\n        this.usbDevice.oninputreport = this.handleInputReport;\n        await this.enableUSBUART();\n        await this.setBaudrate(115200);\n        Object.keys(this.callbackListeners.connect).forEach(key => {\n            this.callbackListeners.connect[key]();\n        });\n    }\n\n    async handleInputReport (event) {\n        // Horrible Windows Hack\n        let end = event.data.byteLength;\n        if (event.data.byteLength === 63) end = event.reportId;\n        for (var i=0; i<end; i++) {\n            let c = event.data.getUint8(i);\n            if (this.waitFlag === c) {\n                this.waitCallback();\n                this.waitFlag = null;\n                this.waitCallback = null;\n            } else if (this.waitLength > 0) {\n                this.waitBuffer.push(c);\n                if (!--this.waitLength) {\n                    this.waitCallback([...this.waitBuffer]);\n                    this.waitCallback = null;\n                    this.waitBuffer = [];\n                }\n            } else {\n                Object.keys(this.callbackListeners.receive).forEach(key => {\n                    this.callbackListeners.receive[key](c);\n                });\n            }\n        }\n    }\n\n    async getReport (r) {\n        const report = await this.usbDevice.receiveFeatureReport(r);\n        const data = [];\n        for (var i=0; i<report.byteLength; i++) data.push(report.getUint8(i))\n        return data;\n    }\n\n    async delay (ms) {\n        return new Promise(res => {\n            setTimeout(res, ms);\n        });\n    }\n\n    async sendReport (r, b) {\n        await this.usbDevice.sendFeatureReport(r, new Uint8Array(b));\n    }\n\n    async run () {\n        await this.sendData([0xfb]);\n    }\n\n    async writeProgram (code) {\n        let data = [0xfd, 0xc0, 0x3f, code.length];\n        data = data.concat(code);\n        await this.sendAndWait(data, 0x4B);\n        // let res = await this.sendAndWaitLen([0xfc, 3], 1);\n        // console.log('program written');\n    }\n\n    async eraseProgram () {\n        const data = [0xfd, 0, 0x8c, 64];\n        for (let i=0; i<64; i++) data.push(0xFF);\n        await this.sendAndWait(data, 0x4b);\n        let res = await this.sendAndWaitLen([0xfc, 3], 1);\n        console.log(res);\n        console.log('memory erased');\n    }\n\n    async sendAndWait (data, flag) {\n        this.waitFlag = flag;\n        return new Promise(res => {\n            this.waitCallback = res;\n            this.sendData(data);\n        });\n    }\n\n    async sendStr (str) {\n        this.sendData(new Uint8Array(strToBytes(str)));\n    }\n\n    async sendAndWaitLen (data, len) {\n        this.waitLength = len;\n        return new Promise(res => {\n            this.waitCallback = res;\n            this.sendData(data);\n        });\n    }\n\n    async sendData (b) {\n        if (!this.usbDevice) return;\n        for (let i=0; i<b.length; i+=60) {\n            const out = b.slice(i, i+60);\n            // console.log(`sending ${out}`)\n            await this.usbDevice.sendReport(out.length, new Uint8Array(out));\n        }\n    }\n\n    async readByte (addr) {\n        const out = [0xfe, addr&0xFF, (addr>>8)&0xFF];\n        const res = await this.sendAndWaitLen(out, 1);\n        console.log(res);\n    }\n\n    async enableUSBUART () {\n        await this.sendReport(0x41, [1]);\n    }\n\n    async setBaudrate (b) {\n        let out = [];\n        for (var i=0; i<4; i++) {\n            out.unshift(b&0xFF);\n            b >>= 8;\n        }\n        out = out.concat([0, 0, 3, 0]);\n        await this.sendReport(0x50, out);\n    }\n}\n\nconst webhid = new WebHID();\nexport default webhid;\n","function hexByte(n){return (n+256).toString(16).substring(1);}\nfunction hexWord(n){return ('00000000'+(n+65536*65536).toString(16)).slice(-8);}\nfunction strToBytes(str) {\n    var res = [];\n    for (let i=0; i<str.length; i++) res.push(str.charCodeAt(i));\n    return res;\n}\n\nexport { hexByte, hexWord, strToBytes };\n","import { strToBytes } from './formatting.js';\n\nconst MICROVM_UUID = '6e400001-b5a3-f393-e0a9-e50e24dcca9e';\nconst WRITE_CHAR = '6e400002-b5a3-f393-e0a9-e50e24dcca9e';\nconst READ_CHAR = '6e400003-b5a3-f393-e0a9-e50e24dcca9e';\n\nclass WebBluetooth {\n    constructor () {\n        this.device = null;\n\n        this.readChar = null;\n        this.writeChar = null;\n        this.isConnected = false;\n\n        this.waitCallback = null;\n        this.waitBuffer = [];\n        this.waitFlag = null;\n        this.waitLength = 0;\n\n        this.callbackListeners = {\n            connect: {},\n            disconnect: {},\n            receive: {}\n        };\n\n        this.onDisconnected = this.onDisconnected.bind(this);\n    }\n\n    scan () {\n        navigator.bluetooth.requestDevice({filters: [{services: [MICROVM_UUID]}]})\n            .then(d => {\n                this.device = d;\n                this.device.addEventListener('gattserverdisconnected', this.onDisconnected);\n                return this.device.gatt.connect();\n            })\n            .then(server => {\n                return server.getPrimaryService(MICROVM_UUID);\n            })\n            .then(service => {\n                service.getCharacteristic(WRITE_CHAR).then(c => {\n                    this.writeChar = c;\n                });\n                service.getCharacteristic(READ_CHAR).then(c => c.startNotifications())\n                    .then(c => {\n                        c.addEventListener('characteristicvaluechanged', this.handleReadChar.bind(this));\n                        this.readChar = c;\n                        this.setConnected();\n                    });\n            })\n            // .then(() => {\n                // this.setConnected();\n            // })\n            .catch(error => console.log(error));\n    }\n\n    disconnect () {\n        this.device.gatt.disconnect();\n        this.device = null;\n    }\n\n    setConnected () {\n        this.isConnected = true;\n        Object.keys(this.callbackListeners.connect).forEach(key => {\n            this.callbackListeners.connect[key]();\n        });\n    }\n\n    registerListener (type, fcn) {\n        if (!this.callbackListeners[type]) {\n            console.log(`Error: Invalid listener type: ${type}`);\n            return;\n        }\n        this.callbackListeners[type][fcn] = fcn;\n    }\n\n    removeListener (type, fcn) {\n        if (!this.callbackListeners[type]) {\n            console.log(`Error: Invalid listener type: ${type}`);\n            return;\n        }\n        delete this.callbackListeners[type][fcn];\n    }\n\n    onDisconnected () {\n        this.isConnected = false;\n        Object.keys(this.callbackListeners.disconnect).forEach(key => {\n            this.callbackListeners.disconnect[key]();\n        });\n    }\n\n    handleReadChar (event) {\n        var input = new Uint8Array(event.target.value.buffer);\n        this.processInput(input);\n    }\n\n    processInput (data) {\n        for (var i=0; i<data.byteLength; i++) {\n            let c = data[i];\n            if (this.waitFlag === c) {\n                this.waitCallback();\n                this.waitFlag = null;\n                this.waitCallback = null;\n            } else if (this.waitLength > 0) {\n                this.waitBuffer.push(c);\n                if (!--this.waitLength) {\n                    this.waitCallback([...this.waitBuffer]);\n                    this.waitCallback = null;\n                    this.waitBuffer = [];\n                }\n            } else {\n                Object.keys(this.callbackListeners.receive).forEach(key => {\n                    this.callbackListeners.receive[key](c);\n                });\n            }\n        }\n    }\n\n    async sendAndWait (data, flag) {\n        this.waitFlag = flag;\n        return new Promise(res => {\n            this.waitCallback = res;\n            this.sendData(data);\n        });\n    }\n\n    async sendStr (str) {\n        this.sendData(new Uint8Array(strToBytes(str)));\n    }\n\n    async sendAndWaitLen (data, len) {\n        this.waitLength = len;\n        return new Promise(res => {\n            this.waitCallback = res;\n            this.sendData(data);\n        });\n    }\n\n    async sendData (data) {\n        for (let i=0; i<data.length; i+=20) {\n            await this.send(data.slice(i, i+20));\n        }\n    }\n\n    send (data) {\n        if (!this.isConnected) return;\n        return new Promise(resolve => {\n            // console.log('Sending: ', data);\n            var output = new Uint8Array(data);\n            this.writeChar.writeValue(output).then(() => {\n                resolve();\n            });\n        });\n    }\n}\n\nconst webbt = new WebBluetooth();\nexport default webbt;\n","const DEVICE_SPEC = {\n    gio: {\n        type: 'hid',\n        RAM_ADDR: 0x20004000,\n        FLASH_ADDR: 0x2A000,\n        PROC_ADDR: 0x2B000,\n        SRC_ADDR: 0x2C000\n    },\n    move: {\n        type: 'ble',\n        RAM_ADDR: 0x20004000,\n        FLASH_ADDR: 0x2A000,\n        PROC_ADDR: 0x2B000,\n        SRC_ADDR: 0x2C000\n    },\n    microbit: {\n        type: 'serial',\n        RAM_ADDR: 0x2001F000,\n        FLASH_ADDR: 0x40000,\n        PROC_ADDR: 0x41000,\n        SRC_ADDR: 0x42000\n    }\n}\n\nfunction getDeviceSpec(name) { return DEVICE_SPEC[name] }\n\nexport default getDeviceSpec;\n","import WebSerial from './webserial.js';\nimport WebHID from './webhid.js';\nimport WebBluetooth from './webbt.js';\n\nimport getDeviceSpec from './device-spec.js';\n\nclass Comms {\n    constructor() {\n        this.device = 'gio';\n        this.type = 'hid';\n        this.commClass = WebHID;\n        this.callbackListeners = {\n            connect: {},\n            disconnect: {},\n            receive: {}\n        };\n\n        this.commClasses = {\n            hid: WebHID,\n            serial: WebSerial,\n            ble: WebBluetooth\n        };\n\n        this.onConnect = this.onConnect.bind(this);\n        this.onDisconnect = this.onDisconnect.bind(this);\n        this.onReceive = this.onReceive.bind(this);\n    }\n\n    setType (type) {\n        const spec = getDeviceSpec(type);\n        this.device = type;\n        this.type = spec.type;\n\n        this.commClass.removeListener('connect', this.onConnect);\n        this.commClass.removeListener('disconnect', this.onDisconnect);\n        this.commClass.removeListener('receive', this.onReceive);\n\n        this.commClass = this.commClasses[spec.type];\n\n        this.commClass.registerListener('connect', this.onConnect);\n        this.commClass.registerListener('disconnect', this.onDisconnect);\n        this.commClass.registerListener('receive', this.onReceive);\n    }\n\n    onConnect () {\n        Object.keys(this.callbackListeners.connect).forEach(key => {\n            this.callbackListeners.connect[key]();\n        });\n    }\n\n    onDisconnect () {\n        Object.keys(this.callbackListeners.disconnect).forEach(key => {\n            this.callbackListeners.disconnect[key]();\n        });\n    }\n\n    onReceive (c) {\n        Object.keys(this.callbackListeners.receive).forEach(key => {\n            this.callbackListeners.receive[key](c);\n        });\n    }\n\n    registerListener (type, fcn) {\n        if (!this.callbackListeners[type]) {\n            console.log(`Error: Invalid listener type: ${type}`);\n            return;\n        }\n        this.callbackListeners[type][fcn] = fcn;\n    }\n\n    removeListener (type, fcn) {\n        if (!this.callbackListeners[type]) {\n            console.log(`Error: Invalid listener type: ${type}`);\n            return;\n        }\n        delete this.callbackListeners[type][fcn];\n    }\n\n    search () {\n        if (this.type === 'hid') this.commClass.searchForUSB();\n        else this.commClass.scan();\n    }\n\n    sendAndWait (data, flag) { return this.commClass.sendAndWait(data,flag); }\n    sendAndWaitLen (data, len) { return this.commClass.sendAndWaitLen(data,len); }\n}\n\nconst comms = new Comms();\nexport default comms;\n","import './monitor.css';\n\nfunction MonitorComponent(props) {\n    return (\n        <div className='monitor-frame'>\n            <div className='monitor-label'>\n                {props.num}\n            </div>\n            <div className='monitor-val'>\n                {props.val}\n            </div>\n        </div>\n    );\n}\n\nexport default MonitorComponent;\n","import { useEffect, useState, useRef } from 'react';\nimport { connect } from 'react-redux';\n\nimport MonitorComponent from '../monitor/monitor.js';\n\nfunction ToolbarMonitorsComponent(props) {\n    const [ isVisible, setIsVisible ] = useState(false);\n    const visibleTimeout = useRef(null);\n    const firstRun = useRef(true);\n\n    useEffect(() => {\n        if (firstRun.current) {\n            firstRun.current = false;\n            return null;\n        }\n\n        setIsVisible(true);\n        if (visibleTimeout.current) clearTimeout(visibleTimeout.current);\n        visibleTimeout.current = setTimeout(() => {\n            setIsVisible(false);\n        }, 2000);\n    }, [props.monitors]);\n\n    return (\n        <>\n        {isVisible ?\n            props.monitors.map((mon, i) => {\n                if (Date.now() - mon.timestamp > 3000) return null\n                return <MonitorComponent key={i} num={i+1} val={mon.value} />\n            }) : null\n        }\n        </>\n    );\n}\n\nconst mapStateToProps = state => {\n    return {\n        monitors: state.monitors\n    }\n};\n\nexport default connect(\n    mapStateToProps\n)(ToolbarMonitorsComponent);\n","import './icon-button.css';\n\nfunction IconButtonComponent(props) {\n    let classNames = 'icon-button ';\n    classNames += props.connected ? 'connected ' : '';\n    classNames += props.spinning ? 'spinning ' : '';\n    return (\n        <div\n            title={props.title}\n            className={classNames}\n            onClick={props.handleClick}>\n            <img\n                className={`icon-button-img ${props.type}`}\n                src={props.src}\n                alt={props.alt} />\n        </div>\n    );\n}\n\nexport default IconButtonComponent;\n","export default __webpack_public_path__ + \"static/media/settings.f0367329.svg\";","import { useContext } from 'react';\n\nimport { ModalContext } from '../contexts/modals.js';\n\nimport IconButtonComponent from '../components/icon-button/icon-button.js';\n\nimport settingsIcon from '../icons/settings.svg';\n\nfunction SettingsButton() {\n    const { modalActions } = useContext(ModalContext);\n\n    function onClick (e) {\n        modalActions.setVisible('settings');\n    }\n\n    return (\n        <IconButtonComponent\n            title={'Edit settings'}\n            src={settingsIcon}\n            alt={'Settings Icon'}\n            type={'settings'}\n            handleClick={onClick}\n        />\n    );\n}\n\nexport default SettingsButton;\n","import Comms from './comms.js';\nimport { hexWord, strToBytes } from './formatting.js';\n\nimport getDeviceSpec from './device-spec.js';\n\n// const RAM_ADDR = 0x2001F000;\n// const RAM_ADDR = 0x20004000;\n\nfunction RAM_ADDR () { return getDeviceSpec(Comms.device).RAM_ADDR; }\nfunction FLASH_ADDR () { return getDeviceSpec(Comms.device).FLASH_ADDR; }\nfunction PROC_ADDR () { return getDeviceSpec(Comms.device).PROC_ADDR; }\nfunction SRC_ADDR () { return getDeviceSpec(Comms.device).SRC_ADDR; }\n\nfunction sendstr (str) {\n    // console.log(`Sending ${str}`);\n    sendReceive(str, 0);\n}\n\nasync function writeBin(bin) {\n    console.log(`[1 of 4] writing ${(bin.length/1000).toFixed(1)}KB to memory`);\n    const start = Date.now();\n    let time = Date.now();\n    await writeMemory(RAM_ADDR(), bin);\n    const ramTime = Date.now() - time;\n    console.log('[2 of 4] copying to flash');\n    time = Date.now();\n    await Comms.sendAndWait(strToBytes(`f1A000,${hexWord(RAM_ADDR())},${hexWord(bin.length/4)}#`), 0x55);\n    const writeTime = Date.now() - time;\n    console.log('[3 of 4] reading data from flash');\n    time = Date.now();\n    const mem = await readWords(0x1A000, bin.length/4);\n    const readTime = Date.now() - time;\n    console.log('[4 of 4] verifying data');\n    if (verifyMemory(bin, mem)) {\n        console.log('Success!');\n        console.log(`Flash time: ${((Date.now() - start)/1000).toFixed(2)}s`,\n                    `Mem write: ${(bin.length/ramTime).toFixed(1)}KBps`,\n                    `Flash write: ${(bin.length/writeTime).toFixed(1)}KBps`,\n                    `Flash read: ${(bin.length/readTime).toFixed(1)}KBps`);\n    } else {\n        console.log('Flash failed');\n    }\n}\n\nasync function getVersion() {\n    return await sendReceive('v', 6);\n}\n\nfunction resetToBootloader() {\n    sendReceive('R', 0);\n}\n\nfunction verifyMemory(src, dst) {\n    if (src.length !== dst.length) return false;\n    let isValid = true;\n    dst.forEach((d, i) => {\n        if (d !== src[i]) {\n            isValid = false;\n            console.log(`verify failed: ${hexWord(i)} - should be: ${hexWord(src[i])} actual: ${hexWord(d)}`);\n        }\n    });\n    return isValid;\n}\n\nasync function sendReceive(str, n) {\n    return new Promise(async res => {\n        const resp = await Comms.sendAndWaitLen(strToBytes(str), n);\n        res(resp);\n    });\n}\n\nasync function writeWord(addr, w) {\n    // console.log(`Writing word ${hexWord(w)} at ${hexWord(addr)}`);\n    if (Comms.type === 'serial' || Comms.type === 'ble') {\n        await sendReceive(`W${hexWord(addr)},${hexWord(w)}#`, 1);\n    } else {\n        sendstr(`W${hexWord(addr)},${hexWord(w)}#`);\n    }\n}\n\nasync function readWord(addr) {\n    return new Promise(async resolve => {\n        const res = await sendReceive(`w${hexWord(addr)}#`, 4);\n        resolve(res);\n    });\n}\n\nasync function readWords(addr, len) {\n    return new Promise(async resolve => {\n        const res = await sendReceive(`R${hexWord(addr)},${hexWord(len)}#`, len*4);\n        resolve(res);\n    });\n}\n\nasync function writeMemory (addr, mem) {\n    while (mem.length%4>0) mem.push(0);\n    var bytes = new Uint8Array(mem);\n    var data = new DataView(bytes.buffer);\n    for (var i=0; i<bytes.length; i+=4) {\n        await writeWord(addr+i, data.getUint32(i, true));\n    }\n}\n\nasync function readMemory(addr, len) {\n    let res = [];\n    for (let i=0; res.length<len; i+=4) {\n        res = res.concat(await readWord(addr));\n        addr += 4;\n    }\n    return res.slice(0, len);\n}\n\nasync function readMemoryWord(addr, len) {\n    let res = [];\n    for (let i=0; res.length<len; i+=4) {\n        let num = 0;\n        const r = await readWord(addr);\n        r.forEach((n, i) => {\n            num |= n << (i*8);\n        });\n        res = res.concat(num);\n        addr += 4;\n    }\n    return res;\n}\n\nasync function sendCommand (addr, bytes) {\n    console.log(bytes);\n    await writeMemory(addr, bytes);\n    const command = `f${hexWord(FLASH_ADDR())},${hexWord(addr)},${Math.ceil(bytes.length/4)}#`;\n    await Comms.sendAndWait(strToBytes(command), 0x55);\n}\n\nasync function download (bytes) {\n    console.log(RAM_ADDR(), PROC_ADDR());\n    await writeMemory(RAM_ADDR(), bytes);\n    const procAddr = hexWord(PROC_ADDR());\n    await Comms.sendAndWait(strToBytes(`f${procAddr},${hexWord(RAM_ADDR())},${hexWord(bytes.length/4)}#`), 0x55);\n    console.log('procs written');\n}\n\nasync function saveSource (bytes) {\n    const len = bytes.length;\n    bytes.unshift(len&0xFF,(len>>8)&0xFF,(len>>16)&0xFF,(len>>24)&0xFF);\n    await writeMemory(RAM_ADDR(), bytes);\n    const srcAddr = hexWord(SRC_ADDR());\n    const command = `f${srcAddr},${hexWord(RAM_ADDR())},${hexWord((bytes.length+4)/4)}#`;\n    await Comms.sendAndWait(strToBytes(command), 0x55);\n    console.log('source saved');\n}\n\nasync function readSource () {\n    console.log('reading source');\n    let addr = SRC_ADDR();\n    return new Promise(async res => {\n        const len = await readMemoryWord(addr, 1);\n        if (len > 1000) {\n            res('');\n            return;\n        }\n        const mem = await readMemory(addr+4, len);\n        let source = '';\n        mem.forEach(b => {\n            if (b === 255 || b === 0) return;\n            source += String.fromCharCode(b);\n        });\n        res(source);\n    });\n}\n\nfunction vmGo() {\n    sendstr('G');\n}\n\nasync function vmStop() {\n  await runCmd([11]);\n}\n\nasync function runCmd (code) {\n    code.push(0);\n    await sendCommand(RAM_ADDR(), code);\n    vmGo();\n}\n\nfunction dumpw(addr, len) {\n    return new Promise(res => {\n        if (len < 1) len = 1;\n        readMemoryWord(addr, len)\n        .then(mem => res(mem));\n    });\n}\n\nfunction dump(addr, len) {\n    return new Promise(res => {\n        if (len < 4) len = 4;\n        readMemory(addr, len)\n            .then(mem => res(mem));\n    });\n}\n\nexport {\n    RAM_ADDR,\n    sendstr,\n    writeWord,\n    writeMemory,\n    readMemory,\n    sendCommand,\n    runCmd,\n    dump,\n    dumpw,\n    writeBin,\n    getVersion,\n    resetToBootloader,\n    vmGo,\n    vmStop,\n    download,\n    saveSource,\n    readSource\n};\n","function versionParser(verString) {\n    if (verString.length !== 5) {\n        console.log(`Error: version string wrong length ${verString}`);\n        return;\n    }\n    const version = {};\n    version.type = verString[4] === 'b' ?\n        'bootloader' : verString[4] === 'v' ? 'vm' : 'unknown';\n    version.major = verString[1];\n    version.minor = verString[2];\n    version.patch = verString[3];\n    return version;\n}\n\nexport default versionParser;\n","export default __webpack_public_path__ + \"static/media/usb.1d2cfada.svg\";","import { useEffect, useState, useContext } from 'react';\n\nimport { SettingsContext } from '../contexts/settings.js';\n\nimport Comms from '../lib/comms.js';\nimport { getVersion } from '../lib/vm-commands.js';\nimport versionParser from '../lib/version-parser.js';\n\nimport IconButtonComponent from '../components/icon-button/icon-button.js';\n\nimport usbIcon from '../icons/usb.svg';\n\nconst USBButton = () => {\n    const [isConnected, setIsConnected] = useState(false);\n    const {settingsState, settingsActions} = useContext(SettingsContext);\n\n    useEffect(() => {\n        Comms.setType(settingsState.deviceType);\n        async function onConnect () {\n            setIsConnected(true);\n            let verString = ''\n            const ver = await getVersion();\n            for (let i=0; i<ver.length-1; i++) verString += String.fromCharCode(ver[i]);\n            const info = versionParser(verString);\n            settingsActions.setDeviceInfo(info);\n            settingsActions.setConnected();\n        }\n\n        function onDisconnect () {\n            setIsConnected(false);\n            settingsActions.clearDeviceInfo();\n            settingsActions.setDisconnected();\n        }\n\n        Comms.registerListener('connect', onConnect);\n        Comms.registerListener('disconnect', onDisconnect);\n        return () => {\n            Comms.removeListener('connect', onConnect);\n            Comms.removeListener('disconnect', onDisconnect);\n        };\n    }, [settingsState, settingsActions]);\n\n    function onClick (e) {\n        Comms.search();\n    }\n\n    return (\n        <IconButtonComponent\n            title={'Connect to device'}\n            src={usbIcon}\n            alt={'USB Icon'}\n            connected={isConnected}\n            handleClick={onClick}\n        />\n    );\n}\n\nexport default USBButton;\n","export default __webpack_public_path__ + \"static/media/logo.eab4e20f.svg\";","export default __webpack_public_path__ + \"static/media/download.a641fbae.svg\";","export default __webpack_public_path__ + \"static/media/loading.1d941467.svg\";","export default __webpack_public_path__ + \"static/media/stop.60e59f26.svg\";","export default __webpack_public_path__ + \"static/media/start.b7615d41.svg\";","export default __webpack_public_path__ + \"static/media/help.464e6453.svg\";","import './header.css';\n\nimport ToolbarMonitorsComponent from '../toolbar-monitors/toolbar-monitors.js';\nimport IconButtonComponent from '../icon-button/icon-button.js';\nimport SettingsButton from '../../containers/settings-button.js';\nimport USBButton from '../../containers/usb-button.js';\n\nimport logo from './logo.svg';\nimport downloadIcon from '../../icons/download.svg';\nimport loadingIcon from '../../icons/loading.svg';\nimport stopIcon from '../../icons/stop.svg';\nimport startIcon from '../../icons/start.svg';\nimport helpIcon from '../../icons/help.svg';\n\nfunction HeaderComponent(props) {\n    return (\n        <div className='header-frame'>\n            <div\n                className='header-title'\n            >\n                <img src={logo} alt='CraftyBits Logo' draggable='false' />\n                CODE\n            </div>\n            <div className='stretch'>\n                <ToolbarMonitorsComponent />\n            </div>\n            <IconButtonComponent\n                src={helpIcon}\n                handleClick={props.onHelp}\n                title={'Toggle help menu'}\n            />\n            <div className='spacer' />\n            <IconButtonComponent\n                src={startIcon}\n                handleClick={props.onStart}\n                title={'Repeat last command'}\n            />\n            <IconButtonComponent\n                src={stopIcon}\n                handleClick={props.onStop}\n                title={'Send stop command'}\n            />\n            <div className='spacer' />\n            <IconButtonComponent\n                src={props.isDownloading ? loadingIcon : downloadIcon}\n                handleClick={props.onDownload}\n                spinning={props.isDownloading}\n                title={'Download procedures to device'}\n            />\n            <div className='spacer' />\n            <SettingsButton />\n            <USBButton />\n            {props.menuVisible &&\n                <div className='header-menu'>\n                    Flash firmware<br />\n                    Test\n                </div>\n            }\n        </div>\n    );\n}\n\nexport default HeaderComponent;\n","/////////////////////////\n//\n// Tokenizer\n//\n/////////////////////////\n\nclass Tokenizer {\n\nconstructor(s){\nthis.str = s;\nthis.offset = 0;\n}\n\nreadList(){\n\tvar a = [];\n\twhile(true){\n\t\tif(this.eof()) break;\n\t\tvar token = this.readToken();\n\t\tif(token==null) break;\n\t\ta.push(token);\n\t}\n\treturn a;\n}\n\nreadToken(){\n\tvar s = this.next();\n\tvar n = Number(s);\n\tif(!isNaN(n)) return n;\n\tvar first = s.charAt(0);\n\tif(first===\"]\") return null;\n\tif(first===\"[\") return this.readList();\n\treturn s;\n}\n\nnext(){\n\tif(this.peekChar()===\"'\") return this.readString();\n    else if(this.peekChar()===\";\") return this.readComment();\n\tvar res='';\n\tif(this.delim()) res=this.nextChar();\n\telse {\n\t\twhile(true){\n\t\t\tif(this.eof()) break;\n\t\t\tif(this.delim()) break;\n\t\t\telse res+=this.nextChar();\n\t}}\n\tthis.skipSpace();\n\treturn res;\n}\n\nreadString(){\n\tthis.nextChar();\n\tvar res=\"'\";\n\twhile (true){\n\t\tvar c=this.nextChar();\n\t\tres+=c;\n\t\tif(c===\"'\") {this.skipSpace(); return res;}\n\t\tif(this.eof()) return res+\"'\";\n\t}\n}\n\nreadComment(){\n\tthis.nextChar();\n\n}\n\nnextLine(){\n\tvar res='';\n\twhile (true){\n\t\tif(this.eof()) return res;\n\t\tvar c=this.nextChar();\n\t\tif(c==='\\n') return res;\n\t\tres+=c;\n\t}\n}\n\n\nskipSpace(){\n\twhile(true){\n\t\tif(this.eof()) return;\n\t\tvar c = this.peekChar();\n        if(c===';') {this.skipComment(); continue;}\n\t\tif(\" \\t\\r\\n,\".indexOf(c)===-1) return;\n\t\tthis.nextChar();\n\t}\n}\n\nskipComment(){\n\twhile(true){\n\t\tvar c = this.nextChar();\n\t\tif(this.eof()) return;\n\t\tif(c==='\\n') return;\n\t}\n}\n\ndelim(){return \"()[] \\t\\r\\n\".indexOf(this.peekChar())!==-1;}\npeekChar(){return this.str.charAt(this.offset);}\nnextChar(){return this.str.charAt(this.offset++);}\neof() {return this.str.length===this.offset;}\n\n}\n\nexport default Tokenizer;\n","const prims =\n  ['stop','c',0, 'output', 'c', 0,\n    'if', 'c', 2, 'ifelse', 'c', 3,\n    'repeat','c',2,'loop','c',1,'waituntil','c',1,\n    '+','r',-1,'-','r',-1, '*','r',-1, '/','r',-1, '%','r',-1,\n    '=','r',-1,'!=','r',-1,'>','r',-1,'<','r',-1,\n    'and','r',-1,'or','r',-1,'xor','r',-1,'not','r',1,\n    '<<','r',-1,'>>','r',-1,\n    'putc','c',1, 'prs','c',1,'print','c',1,\n    'prh','c',1,'prhb','c',1,'prf','c',2,\n    'read','r',1,'write','c',2,'readb','r',1,'writeb','c',2,\n    'bset','c',2,'bclr','c',2,'btst','r',2,\n    'ticks', 'r', 0,\n    'resett', 'c', 0,\n    'timer', 'r', 0,\n    'wait', 'c', 1, 'random', 'r', 0,\n    'nop','c',0,'ignore','r',1,\n    'readd', 'r', 0, 'reada', 'r', 0,\n    'outd', 'c', 1, 'outa', 'c', 1,\n    'rsend', 'c', 1, 'rrecv', 'r', 0,\n    'rsetbox', 'c', 2, 'rgetbox', 'r', 0,\n    'log', 'c', 1, 'mon', 'c', 2,\n    'setled', 'c', 2, 'setbrightness', 'c', 2,\n    'setservo', 'c', 1, 'servo', 'r', 0,\n    'setservoraw', 'c', 1\n];\n\nconst pseudoprims = {};\n\nconst globals = ['box1', 'box2', 'box3', 'rbox1', 'rbox2', 'rbox3'];\nconst constants =  {all: 9999, off: -1}\n\nexport { prims, pseudoprims, globals, constants };\n","import Tokenizer from './tokenizer.js';\n\nexport default function parse(s) {\n    const t = new Tokenizer(s);\n    t.skipSpace();\n    return t.readList();\n}\n","import Tokenizer from './tokenizer.js';\nimport { prims, globals, constants } from './prims.js';\nimport parse from './parse.js';\nimport { hexWord, hexByte } from './formatting.js';\n\nclass Compiler {\n\nlprint(e) {\n    console.log(e);\n}\n\n/////////////////////////////////\n//\n// Entry Points\n//\n/////////////////////////////////\ncompile(str){\n\tthis.pc = 0;\n    try {\n        this.thisproc = undefined;\n        var compiledtokens = this.compileCommands(parse(str));\n        var code = this.encodeItems(compiledtokens);\n        return code;\n    } catch (e) {console.log(e);}\n    return null;\n}\n\ndownloadProcs(str){\n\tthis.pc = this.procaddr;\n\ttry {\n\t\tthis.setup();\n\t\tvar bytes = this.compileProcs(str);\n\t\tcompiler.dump(this.procaddr, bytes);\n        return bytes;\n\t\t// if(comms.port) comms.download(bytes);\n \t} catch (e) {console.log(e)}\n}\n\n\n/////////////////////////////////\n//\n// Vectors\n//\n/////////////////////////////////\n\nvectors(){\n\tvar t = this;\n\tvar res = [];\n\tvar nextvector = 0;\n\n\tfor(var i=0;i<t.vectorlen;i++) res.push(0);\n\tsetupVectors('on-start',0);\n\treturn res;\n\n\tfunction setupVectors(type,op){\n\t\tsetupVector(type,op);\n\t\tfor(var i=1;i<t.vectorlen/4;i++) setupVector(type+i,op);\n\t}\n\n\tfunction setupVector(name, op){\n\t\tvar proc = t.oblist[name];\n\t\tif(proc===undefined) return;\n\t\tvar addr = proc.addr;\n\t\tres[nextvector++] = op //EVAL_PROC\n\t\tres[nextvector++] = addr&0xff;\n\t\tres[nextvector++] = (addr>>8)&0xff;\n\t\tnextvector++;\n\t}\n}\n\n\n/////////////////////////////////\n// \n// Procedure Compiler\n//\n/////////////////////////////////\n\ncompileProcs(str){\n\tvar t = this;\n\tvar tk = new Tokenizer(str);\n\twhile(!tk.eof()) onePass1Command();\n\tfor(var i in t.procnames) compileProcBody(t.procnames[i]);\n\treturn t.encodeProcs();\n\n\tfunction onePass1Command(){\n\t\tvar sol = tk.offset;\n\t\tvar parsed = parse(tk.nextLine());\n\t\tif(parsed.length===0) return;\n\t\t\tif(parsed[0]==='to') parseTo();\n\t\t\telse if(parsed[0]==='constants') parseConstants();\n\t\t\telse if(parsed[0]==='global') parseGlobal();\n\t\t\n\t\tfunction parseTo(){\n\t\t\tvar name = parsed[1];\n\t\t\tvar proc = {};\n\t\t\tparseTitleLine();\n\t\t\tproc.type = 'ufun';\n\t\t\tproc.len = 3;\n\t\t\tproc.nargs = parsed.length-2;\n\t\t\tproc.body = gatherBody();\n\t\t\tproc.outputs = proc.body.match(/(^|\\W)output\\W/)!=null;\n\t\t\tt.oblist[name] = proc;\n\t\t\tt.procnames.push(name);\n\n\t\t\tfunction parseTitleLine(){\n\t\t\t\tif(parsed.length===1) throw new Error('\"to\" needs to be followed by a name');\n\t\t\t\tif((typeof parsed[1])!='string') throw new Error(parsed[1]+' can\\'t be used as a name');\n\t\t\t\tproc.args = [];\n\t\t\t\tproc.locals = [];\n\t\t\t\tvar args = parsed.slice(2);\n\t\t\t\tfor(var i in args){\n\t\t\t\t\tvar arg = args[i];\n\t\t\t\t\tif((typeof arg)!='string') throw new Error('\"'+arg.toString().replace(',',' ')+'\" can\\'t be used as an input name');\n\t\t\t\t\tif(arg[0]!==':') throw new Error('\"'+arg+'\" needs a \":\" to be an input');\n\t\t\t\t\tt.oblist[arg] = {type: 'getlocal', outputs: true};\n\t\t\t\t\tt.oblist['set'+arg] = {type: 'setlocal', outputs: false};\n\t\t\t\t\tproc.args.push(arg); \n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction gatherBody(){\n\t\t\t\tvar res = '';\n\t\t\t\twhile(true){\n\t\t\t\t\tif(tk.eof()) return res;\n\t\t\t\t\tvar line = tk.nextLine();\n\t\t\t\t\tif(line==='end') return res;\n\t\t\t\t\tres = res+line+'\\n';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction parseGlobal(){\n\t\t\tbackup();\n\t\t\tvar globals = tk.readToken();\n\t\t\tfor(var i in globals) t.setupGlobal(globals[i]);\n\t\t}\n\t\t\t\t\n\t\tfunction parseConstants(){\n\t\t\tbackup();\n\t\t\tvar ks = tk.readToken();\n\t\t\tfor(var i in ks) t.constants[ks[i][0]]=ks[i][1];\n\t\t}\n\n\t\tfunction backup(){tk.offset=sol; tk.readToken();}\n\t}\n\t\n\tfunction compileProcBody(name){\n\t\tvar proc = t.oblist[name];\n\t\tt.thisproc = name;\n\t\tproc.addr = t.pc;\n\t\tt.pc += 2;\n\t\tproc.items = t.compileCommands(parse(proc.body+'stop\\n'));\n\t}\n\n}\n\n\t\n/////////////////////////////////\n// \n// Command Compiler\n//\n/////////////////////////////////\n\ncompileCommands(list){\n\tvar t = this;\n\tvar res = [];\n\twhile(list.length>0) compileItem(list.shift());\n\treturn res;\n\n\tfunction compileItem(item, inputfor){\n\t\tvar type = typeof item;\n\t\tif (type==='number') compileNumber(item);\n\t\telse if(type==='object') compileList(item);\n\t\telse if(item.substring(0,1)===\"'\") compileString(item);\n\t\telse if(item.substring(0,1)===':') compileLocalGet(item);\n\t\telse if(item.substring(0,4)==='set:') compileLocalSet(item);\n\t\telse compileSymbol(item);\n\t\tvar command = (t.oblist[item])&&!t.oblist[item].outputs;\n\t\tif((!command)&&(inputfor===undefined)) throw new Error('you don\\'t say what to do with '+item+thisProc());\n\t\tif(inputfor&&command) throw new Error(item+' doesn\\'t output to '+inputfor+thisProc());\n\t}\n\n\tfunction compileNumber(n){\n\t\tif((n<256)&&(n>=0)&&(n===Math.round(n))) addAndCount(['byte',n],2);\n\t\telse addAndCount(['number',n],5)\n\t}\n\n\tfunction compileList(l){\n\t\taddAndCount(['list',0],3)\n\t\tvar oldlist = list;\n\t\tlist = l;\n\t\twhile(list.length>0) compileItem(list.shift());\n\t\tlist = oldlist;\n\t\taddAndCount(['eol',0],1)\n\t}\n\n\tfunction compileString(str){\n\t\tstr = str.substring(1);\n\t\tstr = str.substring(0,str.length-1);\n\t\tstr = str.replaceAll('\\\\n', '\\r');\n\t\tstr += String.fromCharCode(0);\n\t\taddAndCount(['string',str],str.length+3);\n\t}\n\n\tfunction compileLocalGet(name){\n\t\tvar index = localIndex(name);\n\t\tif(index===undefined) throw new Error(name+' has no value'+thisProc());\n\t\taddAndCount(['localget',index],2);\n\t}\n\n\tfunction compileLocalSet(setname){\n\t\tvar name = setname.substring(3);\n\t\tvar index = localIndex(name);\n\t\tif(index===undefined) throw new Error(name+' has no value'+thisProc());\n\t\targloop(1, setname);\n\t\taddAndCount(['localset',index],2);\n\t}\n\n\tfunction compileSymbol(name){\n\t\tvar sym = t.oblist[name];\n\t\tif(constants[name]!==undefined) compileNumber(constants[name]);\n\t\telse if(sym===undefined) throw new Error(`I don't know how to '${name+thisProc()}'`);\n\t\telse if(sym.type==='global') compileGlobalGet(sym.index);\n\t\telse if(sym.type==='setglobal') compileGlobalSet(sym.index);\n\t\telse if(sym.type==='let') compileLet();\n\t\telse if(sym.type==='make') compileMake();\n\t\telse if(sym.type==='opar') compileOpar();\n\t\telse if(sym.type==='waituntil') compileWaituntil();\n\t\t// else if(sym.type=='repeatuntil') compileRepeatuntil();\n\t\telse compileCallSym();\n\n\t\tfunction compileCallSym(){\n\t\t\targloop(sym.nargs, name);\n\t\t\taddAndCount([sym.type, name], sym.len);\n\t\t}\n\n\t\tfunction compileGlobalSet(index){\n\t\t\targloop(1, sym);\n            const rbox = index>2;\n\t\t\taddAndCount(['globalset',rbox?index-3:index,rbox?1:0],3);\n\t\t}\n\n\t\tfunction compileGlobalGet(index){\n            const rbox = index>2;\n\t\t\taddAndCount(['globalget',rbox?index-3:index,rbox?1:0],3);\n\t\t}\n\n\t\tfunction compileWaituntil(){\n\t\t\taddAndCount(['list',0],3)\n\t\t\tvar oldlist = list; list = list.shift();\n\t\t\targloop(1, 'waituntil');\n\t\t\tlist = oldlist;\n\t\t\taddAndCount(['eolr',0],1)\n\t\t\taddAndCount(['prim','waituntil'],1);\n\t\t}\n\n\t\tfunction compileLet(){\n\t\t\tvar old = list;\n\t\t\tlist = old.shift();\n\t\t\twhile(list.length>0){\n\t\t\t\tvar local = ':'+list.shift();\n\t\t\t\tt.oblist[local] = {type: 'getlocal', outputs: true};\n\t\t\t\tt.oblist['set'+local] = {type: 'setlocal', outputs: false};\n\t\t\t\tt.oblist[t.thisproc].locals.push(local);\n\t\t\t\tcompileLocalSet('set'+local);\n\t\t\t}\n\t\t\tlist = old;\n\t\t}\n\n\t\tfunction compileMake(){\n\t\t\tvar name = list.shift();\n\t\t\tif(name.substring(0,1)===':') name=name.substring(1);\n\t\t\tif(name.substring(0,1)==='\"') name=name.substring(1);\n\t\t\tname = ':'+name;\n\t\t\tvar index = localIndex(name);\n\t\t\tif(index===undefined) throw new Error(name+' has no value'+thisProc());\n\t\t\targloop(1, 'make');\n\t\t\taddAndCount(['localset',index],2);\n\t\t}\n\n\t\tfunction compileOpar(){\n\t\t\targloop(1, '(');\n\t\t\tif(!(list.shift()===')')) throw new Error('() error|')\n\t\t}\n\n\t}\n\n\tfunction argloop(nargs, name){\n\t\tfor(var i=0;i<nargs;i++) {\n\t\t\tif(list.length===0) throw new Error(name+' needs more inputs'+thisProc());\n\t\t\tcompileItem(list.shift(),name);\n\t\t\tinfixCheck();\n\t\t}\n\t}\n\n\tfunction infixCheck(){\n\t\tvar infixnext = (list.length>0)&&(t.oblist[list[0]])&&(t.oblist[list[0]].nargs===-1);\n\t\tif(!infixnext) return;\n\t\tvar isym = list.shift();\n\t\tif(list.length===0) throw new Error(isym+' needs more inputs'+thisProc());\n\t\tcompileItem(list.shift(),isym);\n\t\taddAndCount(['prim',isym],1);\n\t\tinfixCheck();\n\t}\n\n\tfunction localIndex(name){\n\t\tif(t.thisproc===undefined) return undefined;\n\t\tvar args = t.oblist[t.thisproc].args;\n\t\tvar index = args.indexOf(name);\n\t\tif(index!==-1) return args.length-1-index;\n\t\tvar locals = t.oblist[t.thisproc].locals;\n\t\tindex = locals.indexOf(name);\n\t\tif(index===-1) return undefined;\n\t\treturn 0xff&-index-1;\n\t}\n\n\tfunction thisProc(){\n\t\tif(t.thisproc) return ' in '+t.thisproc;\n\t\telse return '';\n\t}\n\n\tfunction addAndCount(x,n){\n\t\tres.push([t.pc].concat(x));\n\t\tt.pc+=n;\n\t}\n\n\n}\n\n\n\n\n/////////////////////////////////\n// \n// Generate ByteCodes\n//\n/////////////////////////////////\n\nencodeItems(items){\n\tvar res = [];\n\tvar lists = [];\n\tfor(var i in items) this.encodeItem(items[i], res, lists);\n\treturn res;\n}\n\nencodeProcs(){\n\tvar res = [];\n\tvar lists = [];\n\tfor(var i in this.procnames){\n\t\tvar proc = this.oblist[this.procnames[i]];\n\t\tvar items = proc.items;\n\t\tres.push(proc.args.length);\n\t\tres.push(proc.locals.length);\n\t\tfor(var n in items) this.encodeItem(items[n], res, lists);\n\t}\n\treturn res;\n}\n\nencodeItem(i, res, lists){\n\tvar val = i[2];\n\tswitch(i[1]){\n\tcase 'byte':\n\t\tres.push(1);\n\t\tres.push(val&0xff);\n\t\tbreak;\n\tcase 'number':\n\t\tres.push(2);\n\t\tres.push(val&0xff);\n\t\tres.push((val>>8)&0xff);\n        res.push((val>>16)&0xff);\n        res.push((val>>24)&0xff);\n\t\tbreak;\n\tcase 'list':\n\t\tres.push(3);\n\t\tlists.push(res.length);\n\t\tres.push(0);\n\t\tres.push(0);\n\t\tbreak;\n\tcase 'string':\n\t\tres.push(3);\n\t\tres.push(val.length&0xff);\n\t\tres.push((val.length>>8)&0xff);\n\t\tval.split('').forEach(function(x){res.push(x.charCodeAt(0));});\n\t\tbreak;\n\tcase 'eol':\n\t\taddEOL(4);\n\t\tbreak;\n    case 'eolr':\n\t\taddEOL(5);\n\t\tbreak;\n\tcase 'localget':\n\t\tres.push(6);\n\t\tres.push(val);\n\t\tbreak;\n\tcase 'localset':\n\t\tres.push(7);\n\t\tres.push(val);\n\t\tbreak;\n\tcase 'globalget':\n\t\tres.push(8);\n\t\tres.push(val);\n        res.push(i[3]);\n\t\tbreak;\n\tcase 'globalset':\n\t\tres.push(9);\n\t\tres.push(val);\n        res.push(i[3]);\n\t\tbreak;\n\tcase 'prim':\n\t\tres.push(this.oblist[val].code);\n\t\tbreak;\n\tcase 'pseudoprim':\n\tcase 'ufun':\n\t\tres.push(10);\n\t\tres.push(this.oblist[val].addr&0xff);\n\t\tres.push((this.oblist[val].addr>>8)&0xff);\n\t\tbreak;\n\tdefault:\n\t\tres.push(i[1]);\n\t\tbreak;\n\t}\n\n\tfunction addEOL(n){\n\t\tres.push(n);\n\t\tvar offset = lists.pop();\n\t\tvar len = res.length-offset-2;\n\t\tres[offset] = len&0xff;\n\t\tres[offset+1] = (len>>8)&0xff;\n\t}\n}\n\n\n/////////////////////////////////\n//\n// Setup\n//\n/////////////////////////////////\n\ndumpw(addr,list){\n    for (var i=0; i<list.length; i+=4) {\n\t\tvar line = hexWord(addr+i)+' - ';\n\t\tfor(var n=0;n<4;n++){\n\t\t\tif((i+n)>=list.length) break;\n\t\t\tline+= hexWord(list[n+i]);\n\t\t\tline+= ' ';\n\t\t}\n\t\tconsole.log(line)\n\t}\n}\n\ndump(addr,list){\n    for (var i=0; i<list.length; i+=8) {\n\t\tvar line = hexWord(addr+i)+' - ';\n\t\tfor(var n=0;n<8;n++){\n\t\t\tif((i+n)>=list.length) break;\n\t\t\tline+= hexByte(list[n+i]);\n\t\t\tline+= ' ';\n\t\t}\n\t\tconsole.log(line)\n\t}\n}\n\nsetupGlobal(name){\n\tthis.oblist[name] = {type: 'global', index: this.nextglobal, outputs: true};\n\tthis.oblist['set'+name] = {type: 'setglobal', index: this.nextglobal, outputs: false};;\n\tthis.nextglobal++;\n}\n\n\nsetup(){\n\tvar t = this;\n\tthis.procaddr = 0;\n\tt.vectorlen = 4;\n\tt.oblist = {};\n\tt.constants = {};\n\tt.nextglobal = 0;\n\tt.procnames = [];\n\tsetupBuiltIns();\n\tt.oblist['let'] = {type: 'let', outputs: false};\n\tt.oblist['make'] = {type: 'make', outputs: false};\n\tt.oblist['('] = {type: 'opar', outputs: true};\n    t.oblist['waituntil'].type = 'waituntil';\n\tfor(var i in globals) t.setupGlobal(globals[i]);\n\n\tfunction setupBuiltIns(){\n\t\tvar index = 11;\n\t\tvar list = [].concat(prims);\n\t\twhile(list.length>0){\n\t\t\tvar name = list.shift();\n\t\t\tvar ops = list.shift()==='r';\n\t\t\tvar nargs = list.shift();\n\t\t\tt.oblist[name] = {type: 'prim', len: 1, code: index++, nargs: nargs, outputs: ops};\n\t\t}\n\t}\n\n}\n\n}\n\nconst compiler = new Compiler();\ncompiler.setup();\nexport default compiler;\n","const SET_MONITOR = 'setMonitor';\n\nconst defaultMonitors = [];\nfor (let i=0; i<10; i++) defaultMonitors.push({value: 0, timestamp: 0});\nconst initialState = {\n    monitors: defaultMonitors\n}\n\nconst reducer = function (state, action) {\n    if (typeof state === 'undefined') state = initialState;\n    switch (action.type) {\n    case SET_MONITOR:\n        const change = [...state.monitors];\n        change[action.mon-1].value = action.val;\n        change[action.mon-1].timestamp = Date.now();\n        return Object.assign({}, state, {\n            monitors: change\n        });\n    default:\n        return state\n    }\n\n};\n\nconst setMonitor = function (mon, val) {\n    return {\n        type: SET_MONITOR,\n        mon: mon,\n        val: val\n    }\n};\n\nexport {\n    reducer as default,\n    initialState,\n    setMonitor\n}\n","import { useState, useContext } from 'react';\n\nimport { ModalContext } from '../contexts/modals.js';\n\nimport HeaderComponent from '../components/header/header.js';\n\nimport Compiler from '../lib/compiler.js';\nimport { download, saveSource, vmStop, vmGo } from '../lib/vm-commands.js';\nimport { strToBytes } from '../lib/formatting.js';\n\nfunction Header(props) {\n    const { modalState, modalActions } = useContext(ModalContext);\n    const [menuVisible, setMenuVisible] = useState(false);\n    const [downloading, setDownloading] = useState(false);\n\n    function toggleMenu (props) {\n        setMenuVisible(!menuVisible);\n    }\n\n    const handleDownload = async () => {\n        setDownloading(true);\n        const str = props.procRef.current.value;\n        const strBytes = strToBytes(str);\n        const bytes = Compiler.downloadProcs(str);\n        if (!bytes || bytes.length === 0) return;\n        await download(bytes);\n        await saveSource(strBytes);\n        setDownloading(false);\n    };\n\n    const handleStart = () => {\n      vmGo();\n    };\n\n    const handleStop = () => {\n      vmStop();\n    };\n\n    const handleHelp = () => {\n      if (modalState.help) {\n        modalActions.setHidden('help');\n      } else {\n        modalActions.setVisible('help');\n      }\n    };\n\n    return (\n        <HeaderComponent\n            onToggleMenu={toggleMenu}\n            menuVisible={menuVisible}\n            onDownload={handleDownload}\n            onStop={handleStop}\n            onStart={handleStart}\n            onHelp={handleHelp}\n            isDownloading={downloading}\n        />\n    );\n}\n\nexport default Header;\n","function useVersionParser(verString) {\n    if (verString.length !== 5) {\n        console.log(`Error: version string wrong length ${verString}`);\n        return;\n    }\n    const version = {};\n    version.type = verString[4] === 'b' ?\n        'bootloader' : verString[4] === 'v' ? 'vm' : 'unknown';\n    version.major = verString[1];\n    version.minor = verString[2];\n    version.patch = verString[3];\n    return version;\n}\n\nexport default useVersionParser;\n","import './editor.css';\n\nfunction EditorComponent(props) {\n    const padding = props.side === 'left' ? '10px 5px 10px 10px' : '10px 10px 10px 5px';\n    const flexStyle = {\n        display: 'flex',\n        flex: props.flex,\n        padding: padding\n    };\n    const classes = 'editor-text ' + (props.showDefaultText ? 'default' : '');\n    return (\n        <div className='editor-frame' style={flexStyle}>\n            <div className='editor-tools'>{props.tools}</div>\n            <div className='editor-text-frame'>\n                <textarea\n                    ref={props.textRef}\n                    className={classes}\n                    onKeyDown={props.onChange}\n                    onDrop={props.onDrop}\n                    onFocus={props.onFocus}\n                    onBlur={props.onBlur}\n                    defaultValue={props.defaultValue}\n                    autoCapitalize={'false'}\n                    autoCorrect={'false'}\n                    autoComplete={'false'}\n                    spellCheck={'false'}\n                >\n                </textarea>\n            </div>\n        </div>\n    );\n}\n\nexport default EditorComponent;\n","import { useEffect, useRef, useContext, useState } from 'react';\n\nimport { connect } from 'react-redux';\nimport { setMonitor } from '../reducers/monitors.js';\nimport { SettingsContext } from '../contexts/settings.js';\n\nimport useVersionParser from '../hooks/use-version-parser.js';\n\nimport EditorComponent from '../components/editor/editor.js';\n\nimport Comms from '../lib/comms.js';\nimport Compiler from '../lib/compiler.js';\nimport { runCmd } from '../lib/vm-commands.js';\n\nfunction CommandCenter(props) {\n    const { settingsActions } = useContext(SettingsContext);\n    const [showDefaultText, setShowDefaultText] = useState(true);\n    const defaultText = `Welcome to LOGO!\\n\\nThis is the command center\\n\\n`\n        + `You can run commands by typing them here and pressing [return]\\n\\n`\n        + `The box to the right is for custom procedures\\n\\n`\n        + `To begin, try running the command 'print 1234' in this box`;\n    const textRef = useRef(null);\n\n    useEffect(() => {\n        let respStr = '';\n\n        function ParseVersion(str) {\n            const version = useVersionParser(str);\n            settingsActions.setDeviceInfo(version);\n        }\n\n        const updateMonitor = (mon, val) => {\n          props.updateMonitor(mon, val);\n        };\n\n        function handleReceive (c) {\n            if (c === 13) {\n                if (respStr[0] === '%') console.log(respStr.substr(1));\n                else if (respStr[0] === '*') ParseVersion(respStr);\n                else if (respStr[0] === '#') updateMonitor(respStr[1], respStr.substr(2));\n                else insert(respStr);\n                respStr = '';\n            } else respStr += String.fromCharCode(c);\n        }\n        Comms.registerListener('receive', handleReceive);\n        return () => {\n            Comms.removeListener('receive', handleReceive);\n        };\n    }, [settingsActions, props]);\n\n    function handleChange (e) {\n        if (e.keyCode === 13) {\n            if (e.shiftKey) insertCR(e);\n            else runCommand(e);\n        }\n    }\n\n    function handleFocus (e) {\n      setShowDefaultText(false);\n      if (e.target.value === defaultText) {\n        e.target.value = '';\n      }\n    }\n\n    function handleBlur (e) {\n      if (e.target.value.length === 0) {\n        e.target.value = defaultText;\n        setShowDefaultText(true);\n      }\n    }\n\n    function runCommand (e) {\n        const t = textRef.current;\n        const pos = t.selectionStart;\n        const start = t.value.lastIndexOf('\\n', pos-1);\n        let end = t.value.indexOf('\\n', pos);\n        if (end<0) end = t.value.length;\n        t.selectionStart = end+1;\n        if (end !== t.value.length) e.preventDefault();\n        const str = t.value.substring(start+1, end);\n        const code = Compiler.compile(str);\n        if (code) runCmd(code);\n    }\n\n    function insertCR (e) {\n        e.preventDefault();\n        const t = textRef.current;\n        const pos = t.selectionStart;\n        const val = t.value;\n        const before = val.substring(0, pos);\n        const after = val.substring(pos);\n        t.value = before + '\\n' + after;\n        t.selectionStart = pos + 1;\n        t.selectionEnd = pos + 1;\n    }\n\n    function insert (str) {\n        str += '\\n';\n        const t = textRef.current;\n        const startPos = t.selectionStart;\n        const endPos = t.selectionEnd;\n        const val = t.value;\n        const before = val.substring(0, startPos);\n        const after = val.substring(endPos);\n        const oldTop = t.scrollTop;\n        t.value = before + str;\n        const halfScroll = t.scrollHeight - t.scrollTop - t.offsetHeight;\n        t.value = before + str + after;\n        t.selectionStart = startPos + str.length;\n        t.selectionEnd = startPos + str.length;\n        if (halfScroll > 0) t.scrollTop += halfScroll;\n        else t.scrollTop = oldTop;\n    }\n\n    return (\n        <EditorComponent\n            textRef={textRef}\n            flex={props.weight}\n            side={props.side}\n            onChange={handleChange}\n            defaultValue={defaultText}\n            showDefaultText={showDefaultText}\n            onFocus={handleFocus}\n            onBlur={handleBlur}\n        />\n    );\n}\n\nconst mapDispatchToProps = dispatch => ({\n    updateMonitor: (mon, val) => dispatch(setMonitor(mon, val))\n});\n\nexport default connect(\n    null,\n    mapDispatchToProps\n)(CommandCenter);\n","import { useContext, useEffect, useState } from 'react';\n\nimport CommandCenter from '../../containers/command-center.js';\nimport EditorComponent from '../editor/editor.js';\n// import ProcToolsComponent from '../proc-tools/proc-tools.js';\nimport { SettingsContext } from '../../contexts/settings.js';\n\nimport { readSource } from '../../lib/vm-commands.js';\nimport Compiler from '../../lib/compiler.js';\n// import { strToBytes } from '../../lib/formatting.js';\n\nimport './editor-container.css';\n\nconst EditorContainer = (props) => {\n    const [ sourceCode, setSourceCode ] = useState(null);\n    const { settingsState } = useContext(SettingsContext);\n\n    useEffect(() => {\n        if (Object.keys(settingsState.info).length > 0 && settingsState.info.type === 'vm') {\n            readSource().then(source => {\n                console.log(source);\n                Compiler.downloadProcs(source);\n                setSourceCode(source);\n            });\n        }\n    }, [settingsState.info]);\n\n    function handleDrop(e) {\n      e.preventDefault();\n      if (e.stopPropagation) e.stopPropagation();\n      const file = e.dataTransfer.files[0];\n      if (file.type === 'text/plain') {\n        const reader = new FileReader();\n        reader.onload = () => {\n          props.procRef.current.value = reader.result;\n        };\n        reader.readAsText(file);\n      }\n    }\n\n    // const handleDownload = async () => {\n        // const str = props.procRef.current.value;\n        // const strBytes = strToBytes(str);\n        // const bytes = Compiler.downloadProcs(str);\n        // if (!bytes || bytes.length === 0) return;\n        // await download(VM_ADDR(), bytes);\n        // await saveSource(strBytes);\n    // };\n    // const handleUpload = async () => {\n        // const source = await readSource();\n        // props.procRef.current.value = source;\n        // Compiler.compileProcs(source);\n    // };\n    return (\n        <div className='editor-container'>\n            <CommandCenter\n                weight={4}\n                side={'left'}\n            />\n            <EditorComponent\n                flex={6}\n                side={'right'}\n                textRef={props.procRef}\n                defaultValue={sourceCode}\n                onDrop={handleDrop}\n            />\n        </div>\n    );\n}\n\nexport default EditorContainer;\n","import './footer.css';\n\nfunction FooterComponent() {\n    return (\n        <div className='footer-frame'>CraftyBits - Kreg Hanning 2021</div>\n    );\n}\n\nexport default FooterComponent;\n","import './box.css';\n\nfunction BoxComponent(props) {\n    function stopProp(e) {\n        e.stopPropagation();\n    }\n    return (\n        <div\n            className='box-frame'\n            onClick={props.onClose}>\n            <div\n                className='box-content'\n                onClick={stopProp}>\n                {props.children}\n            </div>\n        </div>\n    );\n}\n\nexport default BoxComponent;\n","import BoxComponent from '../components/box/box.js';\n\nfunction Box(props) {\n    return (\n        <BoxComponent {...props} />\n    );\n}\n\nexport default Box;\n","import Box from '../../containers/box.js';\n\nimport './settings-modal.css';\n\nfunction SettingsModalComponent(props) {\n    const devActive = Object.keys(props.devInfo).length > 0;\n    const reset = () => {\n        const type = props.devInfo.type === 'vm' ? 'bootloader' : 'vm';\n        props.onReset(type);\n    }\n    return (\n        <Box onClose={props.closeSettings}>\n            <div className='settings-frame'>\n                <div className='settings-header'>Settings</div>\n                <div className='settings-row'>\n                    Device:\n                    <select\n                        name='device-type'\n                        className='settings-device-type'\n                        onChange={props.changeSettings}\n                        value={props.deviceType}>\n                        <option value='gio'>CraftyBits Gio</option>\n                        <option value='move'>CraftyBits Move</option>\n                        <option value='microbit'>micro:bit</option>\n                    </select>\n                </div>\n                <div className='settings-title'>Device Info</div>\n                <div className='settings-row'>\n                    Status: {devActive ? 'connected' : 'Not connected'}\n                </div>\n                { devActive &&\n                    <div className='settings-dev-info'>\n                        <div className='settings-row'>\n                            mode: {props.devInfo.type}\n                        </div>\n                        <div className='settings-row'>\n                            version: {props.devInfo.major}.{props.devInfo.minor}.{props.devInfo.patch}\n                        </div>\n                        <button\n                            className='settings-button'\n                            disabled={props.isFlashing}>\n                            Disconnect\n                        </button>\n                        <br />\n                        { !props.webserial &&\n                            <button\n                                className='settings-button'\n                                onClick={reset}\n                                disabled={props.isFlashing}>\n                                {props.devInfo.type === 'vm' ? 'Reset to Bootloader' : 'Launch vm'}\n                            </button>\n                        }\n                        <br />\n                        { props.devInfo.type === 'bootloader' &&\n                            <button\n                                className='settings-button'\n                                onClick={props.onFlashFirmware}\n                                disabled={props.isFlashing}>\n                                Flash Firmware\n                            </button>\n                        }\n                    </div>\n                }\n            </div>\n        </Box>\n    );\n}\n\nexport default SettingsModalComponent;\n","import { useContext, useState } from 'react';\n\nimport { writeBin, resetToBootloader, vmGo } from '../lib/vm-commands.js';\n\nimport SettingsModalComponent from '../components/settings-modal/settings-modal.js';\n\nimport { ModalContext } from '../contexts/modals.js';\nimport { SettingsContext } from '../contexts/settings.js';\n\nfunction SettingsModal(props) {\n    const { settingsState, settingsActions } = useContext(SettingsContext);\n    const [isFlashing, setIsFlashing] = useState(false);\n    const { modalActions } = useContext(ModalContext);\n\n    function handleClose() {\n        modalActions.setHidden('settings');\n    }\n\n    function handleSettingsChange(e) {\n        const setting = e.target.name;\n        switch(setting) {\n        case 'autoconnect':\n            settingsActions.setAutoconnect(e.target.checked);\n            break;\n        case 'device-type':\n            settingsActions.setDeviceType(e.target.value)\n            break;\n        default: break;\n        }\n    }\n\n    function handleReset(type) {\n        if (type === 'bootloader') resetToBootloader();\n        else if (type === 'vm') vmGo();\n    }\n\n    const handleFlashFirmware = (e) => {\n        setIsFlashing(true);\n        if (e.shiftKey) {\n            const input = document.createElement('input');\n            input.type = 'file';\n            input.oninput = handleUpload;\n            input.click();\n        } else {\n            fetch('https://craftybits.net/firmware/gio/latest')\n            .then(res => res.arrayBuffer())\n            .then(async buffer => {\n                const bin = new Uint8Array(buffer);\n                await writeBin(bin);\n                setIsFlashing(false);\n            });\n        }\n    };\n\n    function handleUpload (e) {\n        const file = e.target.files[0];\n        const reader = new FileReader();\n        reader.onload = async (e) => {\n            const bin = new Uint8Array(e.target.result);\n            await writeBin(bin);\n            setIsFlashing(false);\n        };\n        reader.readAsArrayBuffer(file);\n    }\n\n    return (\n        <SettingsModalComponent\n            autoconnect={settingsState.auto}\n            deviceType={settingsState.deviceType}\n            devInfo={settingsState.info}\n            closeSettings={handleClose}\n            changeSettings={handleSettingsChange}\n            onReset={handleReset}\n            onFlashFirmware={handleFlashFirmware}\n            isFlashing={isFlashing}\n            {...props}\n        />\n    );\n}\n\nexport default SettingsModal;\n","function HelpOutputs(props) {\n  const cmds = props.commandList.map((c, i) => {\n    return c.str;\n  });\n  const args = props.commandList.map((c, i) => {\n    return c.args;\n  });\n  const commandList = [];\n  cmds.forEach((c, i) => {\n    const out = [];\n    const argDivs = [];\n    const argKeys = Object.keys(args[i]);\n    c = c.replace(/ /g, '\\u00a0');\n    argKeys.forEach((a, n) => {\n      let tmp = c.split(a)[0];\n      if (tmp[tmp.length-1] === '[' && n > 0)\n        argDivs.push('[');\n      argDivs.push(\n        <div\n          className='help-command-param'\n          key={`${a}-${i}-arg`}\n        >\n          {args[i][a]}\n        </div>\n      );\n      tmp = c.split(a)[1];\n      if (tmp && tmp[0] === ']' && n < argKeys.length -1)\n        argDivs.push(']');\n      if (n < argKeys.length-1) argDivs.push('\\u00a0');\n    });\n    out.push(\n      <div className='help-command-title' key={i+'title'}>\n        {(argKeys.length > 0) ? c.split(argKeys[0])[0] : c}\n        {argDivs}\n        {(argKeys.length > 0) ? c.split(argKeys[argKeys.length-1])[1] : ''}\n      </div>\n    );\n    out.push(\n      <div className='help-command-description' key={i+'desc'}>\n        {props.commandList[i].description}\n      </div>\n    );\n    out.push(\n      <div className='help-command-example' key={i+'example'}>\n        {'example: ' + props.commandList[i].example}\n      </div>\n    );\n    commandList.push(out);\n  });\n  const commands = props.commandList.map((c, i) =>\n    <li className='help-command'\n        key={i}\n    >\n    {commandList[i]}\n    </li>\n  );\n  return (\n    <div className='help-content'>\n      <ul>{commands}</ul>\n    </div>\n  );\n}\n\nexport default HelpOutputs;\n","import HelpOutputs from './help-outputs.js';\n\nimport './help-modal.css';\n\nfunction HelpModalComponent(props) {\n  return (\n    <div className='help-container'>\n      <div className='help-header'>\n        <ul className='help-nav'>{props.categories}</ul>\n      </div>\n      <HelpOutputs\n        commandList={props.commands[props.selected]}\n      />\n    </div>\n  );\n}\n\nexport default HelpModalComponent;\n","const HelpDictionary = {\n  Outputs: [\n    {\n      str: 'outd STATE',\n      name: 'Output Digital',\n      description: 'Set the output (green port) either 1 (on 5v) or 0 (off 0v)',\n      example: 'outd 1',\n      args: {\n        STATE: 'state'\n      }\n    },\n    {\n      str: 'outa POWER',\n      name: 'Output Analog',\n      description: 'Set the output (green port) on with a duty cycle between 0 - 100%',\n      example: 'outa 50',\n      args: {\n        POWER: 'power'\n      }\n    },\n    {\n      str: 'setservo DEGREES',\n      name: 'Output servo',\n      description: 'Rotate a servo motor to an angle between 0 - 180 degrees',\n      example: 'setservo 120',\n      args: {\n        DEGREES: 'degrees'\n      }\n    },\n    {\n      str: 'setled LED COLOR',\n      name: 'Output LED',\n      description: 'Set a ws281x LED to a color between 0 - 100',\n      example: 'setled 1 30',\n      args: {\n        LED: 'led',\n        COLOR: 'color'\n      }\n    },\n    {\n      str: 'setbrightness LED BRIGHTNESS',\n      name: 'Output LED brightness',\n      description: 'Set a ws281x LED brightness between 0 - 100%',\n      example: 'setbrightness 1 50',\n      args: {\n        LED: 'led',\n        BRIGHTNESS: 'brightness'\n      }\n    }\n  ],\n  Inputs: [\n    {\n      str: 'readd',\n      name: 'Read digital value',\n      description: 'Read a digital value (0 or 1) from the input (purple port)',\n      example: 'print readd',\n      args: {\n      }\n    },\n    {\n      str: 'reada',\n      name: 'Read analog value',\n      description: 'Read an analog value between 0 - 100 from the input (purple port)',\n      example: 'print reada',\n      args: {\n      }\n    }\n  ],\n  Control: [\n    {\n      str: 'wait MILLIS',\n      name: 'Wait for n milliseconds',\n      description: 'Wait for milliseconds',\n      example: 'wait 1000',\n      args: {\n        MILLIS: 'millis'\n      }\n    },\n    {\n      str: 'waituntil [CONDITION]',\n      name: 'Wait until condition',\n      description: 'Wait until a condition is true',\n      example: 'waituntil [reada > 50]',\n      args: {\n        CONDITION: 'condition'\n      }\n    },\n    {\n      str: 'repeat COUNT [SUBROUTINE]',\n      name: '',\n      description: 'repeat a subroutine',\n      example: 'repeat 10 [print 1234]',\n      args: {\n        COUNT: 'count',\n        SUBROUTINE: 'subroutine'\n      }\n    },\n    {\n      str: 'loop [SUBROUTINE]',\n      name: '',\n      description: 'Loop a subroutine forever',\n      example: 'loop [print 1234 wait 1000]',\n      args: {\n        SUBROUTINE: 'subroutine'\n      }\n    },\n    {\n      str: 'if CONDITION [SUBROUTINE]',\n      name: '',\n      description: 'if a condition is true run subroutine',\n      example: 'if reada > 50 [prs \\'ok\\']',\n      args: {\n        CONDITION: 'condition',\n        SUBROUTINE: 'subroutine'\n      }\n    },\n    {\n      str: 'ifelse CONDITION [SUBROUTINE1] [SUBROUTINE2]',\n      name: '',\n      description: 'if a condition is true, run sub1, otherwise, run sub2',\n      example: 'ifelse reada > 50 [prs \\'yes\\'] [prs \\'no\\']',\n      args: {\n        CONDITION: 'condition',\n        SUBROUTINE1: 'sub1',\n        SUBROUTINE2: 'sub2'\n      }\n    },\n    {\n      str: 'stop',\n      name: '',\n      description: 'Stop all proceedures',\n      example: 'stop',\n      args: {\n      }\n    }\n  ],\n  Utils: [\n    {\n      str: 'print NUMBER',\n      name: '',\n      description: 'print a number',\n      example: 'print 1234',\n      args: {\n        NUMBER: 'number'\n      }\n    },\n    {\n      str: 'prs \\'STRING\\'',\n      name: '',\n      description: 'print a string',\n      example: 'prs \\'Hello, World!\\'',\n      args: {\n        STRING: 'string'\n      }\n    },\n    {\n      str: 'timer',\n      name: '',\n      description: 'Get the current timer value in milliseconds',\n      example: 'print timer',\n      args: {\n      }\n    },\n    {\n      str: 'resett',\n      name: '',\n      description: 'Reset the timer to 0',\n      example: 'resett wait 1000 print timer',\n      args: {\n      }\n    }\n  ],\n  Variables: [\n    {\n      str: 'setboxNUMBER VALUE',\n      name: '',\n      description: 'Set global variable (0 - 5) to some value',\n      example: 'setbox1 50',\n      args: {\n        NUMBER: 'number',\n        VALUE: 'value'\n      }\n    },\n    {\n      str: 'boxNUMBER',\n      name: '',\n      description: 'Get value of global variable (0 - 5)',\n      example: 'print box1',\n      args: {\n        NUMBER: 'number',\n        VALUE: 'value'\n      }\n    },\n    {\n      str: 'setrboxNUMBER VALUE',\n      name: '',\n      description: 'Set global radio (shared) variable (0 - 5) to some value',\n      example: 'setrbox1 50',\n      args: {\n        NUMBER: 'number',\n        VALUE: 'value'\n      }\n    },\n    {\n      str: 'rboxNUMBER',\n      name: '',\n      description: 'Get value of global radio (shared) variable (0 - 5)',\n      example: 'print rbox1',\n      args: {\n        NUMBER: 'number',\n        VALUE: 'value'\n      }\n    }\n  ],\n  Operators: [\n    {\n      str: '+ - * / %',\n      name: '',\n      description: 'Performs operation on two numbers',\n      example: 'print 250 / 50',\n      args: {\n      }\n    },\n    {\n      str: '> < = !=',\n      name: '',\n      description: 'Compares two numbers',\n      example: 'if 50 > 40 [prs \\'ok\\']',\n      args: {\n      }\n    },\n    {\n      str: 'and, or, not',\n      name: '',\n      description: 'Combines conditions',\n      example: 'if timer > 1000 and box1 > 50 [prs \\'ok\\']',\n      args: {\n      }\n    },\n    {\n      str: 'random',\n      name: '',\n      description: 'Get a random 32-bit signed integer',\n      example: 'print random % 100',\n      args: {\n      }\n    }\n  ]\n};\n\nexport default HelpDictionary;\n","import { useState } from 'react';\n\nimport HelpModalComponent from '../components/help-modal/help-modal.js';\n\nimport HelpDictionary from '../components/help-modal/help-dictionary.js';\n\nfunction HelpModal() {\n  const [selectedCategory, setSelectedCategory] = useState(0);\n  const categories = Object.keys(HelpDictionary);\n  const categoryDivs = Object.keys(HelpDictionary).map(key => {\n    const classname = 'help-category ' + key;\n    return <li className={classname} onClick={() => {handleChangeCategory({key})}} key={key}>{key}</li>\n  });\n  const commands = categories.map(c => {\n    return HelpDictionary[c];\n  });\n\n  function handleChangeCategory(e) {\n    setSelectedCategory(categories.indexOf(e.key));\n  }\n\n  return (\n    <HelpModalComponent\n      selected={selectedCategory}\n      categories={categoryDivs}\n      commands={commands}\n    />\n  );\n}\n\nexport default HelpModal;\n","import { useEffect, useContext, createRef } from 'react';\n\nimport { ModalContext } from '../../contexts/modals.js';\nimport { SettingsContext } from '../../contexts/settings.js';\n\nimport Comms from '../../lib/comms.js';\n\nimport Header from '../../containers/header.js';\nimport EditorContainer from '../editor-container/editor-container.js';\nimport FooterComponent from '../footer/footer.js';\n\nimport SettingsModal from '../../containers/settings-modal.js';\nimport HelpModal from '../../containers/help-modal.js';\n\nimport './gui.css';\n\nfunction GUIComponent(props) {\n    const { modalState } = useContext(ModalContext);\n    const { settingsState } = useContext(SettingsContext);\n    const procRef = createRef();\n    useEffect(() => {\n        Comms.setType(settingsState.deviceType);\n    }, [settingsState]);\n    return (\n        <div className='gui-frame' onDrop={props.handleDrop}>\n            {settingsState.auto}\n            <div className='gui-header'>\n                <Header procRef={procRef} />\n            </div>\n            <div className='gui-body'>\n                <EditorContainer procRef={procRef} />\n            </div>\n            { modalState.help && <HelpModal /> }\n            <div className='gui-footer'>\n                <FooterComponent />\n            </div>\n            {modalState.settings && <SettingsModal />}\n        </div>\n    );\n}\n\nexport default GUIComponent;\n","import GUIComponent from '../components/gui/gui.js';\n\nimport { SettingsProvider } from '../contexts/settings.js';\nimport { ModalProvider } from '../contexts/modals.js';\n\nimport { getSettings } from '../lib/local-settings.js';\n\nfunction GUI() {\n    const savedSettings = getSettings();\n    const defaultSettings = {\n        auto: false,\n        deviceType: 'gio',\n        ...savedSettings\n    };\n\n    function onDrop(e) {\n      e.preventDefault();\n      if (e.stopPropagation) e.stopPropagation();\n      // const file = e.dataTransfer.files[0];\n      // if (file.type === 'text/plain') {\n        // const reader = new FileReader();\n        // reader.onload = () => {\n          // console.log(reader.result);\n        // };\n        // reader.readAsText(file);\n      // }\n    }\n\n    return (\n        <SettingsProvider value={defaultSettings}>\n            <ModalProvider>\n                <GUIComponent handleDrop={onDrop} />\n            </ModalProvider>\n        </SettingsProvider>\n    );\n}\n\nexport default GUI;\n","function WebRTC() {\n\n    let localConnection = null;\n    // let sendChannel = null;\n\n    return {\n        createConnection: function() {\n            const servers = null;\n            localConnection = new RTCPeerConnection(servers);\n            // sendChannel = localConnection.createDataChannel('sendDataChannel');\n            localConnection.createOffer()\n                .then(desc => {console.log(desc.sdp); console.log(btoa(unescape(encodeURIComponent(desc.sdp))))});\n        }\n    }\n}\n\nconst webrtc = WebRTC();\nexport default webrtc;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport GUI from './containers/gui.js';\n\nimport { Provider } from 'react-redux';\nimport { createStore } from 'redux';\nimport monitorReducer from './reducers/monitors.js';\n\nimport { dump, dumpw, writeMemory, readMemory, sendstr } from './lib/vm-commands.js';\nimport Compiler from './lib/compiler.js';\n\nimport WebRTC from './lib/webrtc.js';\n\nwindow.Compiler = Compiler;\nwindow.dump = dump;\nwindow.dumpw = dumpw;\nwindow.writeMemory = writeMemory;\nwindow.readMemory = readMemory;\nwindow.WebRTC = WebRTC;\nwindow.sendstr = sendstr;\n\nconst store = createStore(monitorReducer);\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n        <GUI />\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}